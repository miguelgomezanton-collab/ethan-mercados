<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ethan mercados Â· Plataforma</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230b1f1f'/><text x='16' y='22' text-anchor='middle' font-size='16' font-weight='bold' fill='%2340d9c0'>E</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Montserrat:wght@200;300;400;500;600&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ETHAN MERCADOS Â· PLATAFORMA
   Visual identity matching ethanmercados.com
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
  /* Main palette from ethanmercados.com */
  --bg-deep:   #040e0e;
  --bg-dark:   #071717;
  --bg-mid:    #0b1f1f;
  --surface:   #0f2828;
  --surface2:  #133232;
  --border:    #1a3c3c;
  --border2:   #245050;

  /* Teal accent (hero glow) */
  --teal:      #40d9c0;
  --teal-dim:  rgba(64,217,192,0.06);
  --teal-mid:  rgba(64,217,192,0.15);
  --teal-glow: rgba(64,217,192,0.25);
  --teal-bright: #5eecd5;
  --teal-dark: #2ba897;

  /* Complementary */
  --cyan:      #38bdf8;
  --red:       #f47174;
  --green:     #4ade80;
  --amber:     #fbbf24;

  /* Text */
  --text1:     #f0f5f4;
  --text2:     #9cb8b4;
  --text3:     #4a706a;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; overflow: hidden; background: var(--bg-deep); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN â€” Hero style like ethanmercados.com
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-screen {
  position: fixed;
  inset: 0;
  z-index: 99999;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.7s ease, transform 0.7s ease;

  /* Background image (hero.jpg) with dark overlay */
  background:
    linear-gradient(180deg, rgba(4,14,14,0.45) 0%, rgba(4,14,14,0.55) 50%, rgba(4,14,14,0.85) 100%),
    url('hero.jpg') center center / cover no-repeat;
  background-color: #040e0e;
}
#login-screen::after {
  /* Subtle noise texture */
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0.015;
  background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='256' height='256' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  background-size: 128px;
  pointer-events: none;
}

#login-screen.hidden {
  opacity: 0;
  transform: scale(1.02);
  pointer-events: none;
}

.login-box {
  text-align: center;
  width: 420px;
  padding: 0 20px;
  position: relative;
  z-index: 2;
}

.login-logo-img {
  height: 52px;
  margin-bottom: 40px;
  opacity: 0.95;
}

.login-heading {
  font-family: 'Cormorant Garamond', serif;
  font-size: 52px;
  font-weight: 300;
  font-style: italic;
  color: var(--text1);
  line-height: 1.15;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}
.login-heading em {
  font-style: italic;
  color: var(--teal);
}

.login-subtitle {
  font-family: 'Montserrat', sans-serif;
  font-size: 18px;
  font-weight: 300;
  color: var(--text2);
  letter-spacing: 4px;
  text-transform: uppercase;
  margin-bottom: 48px;
}
.login-subtitle em {
  font-style: normal;
  color: var(--teal);
}

.login-field {
  margin-bottom: 14px;
}
.login-field input {
  width: 100%;
  padding: 16px 20px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  color: var(--text1);
  font-family: 'Montserrat', sans-serif;
  font-size: 13px;
  font-weight: 400;
  letter-spacing: 3px;
  outline: none;
  transition: border-color 0.3s, background 0.3s;
  backdrop-filter: blur(10px);
}
.login-field input:focus {
  border-color: var(--teal);
  background: rgba(64,217,192,0.04);
}
.login-field input::placeholder {
  color: var(--text3);
  letter-spacing: 4px;
  font-size: 11px;
  font-weight: 400;
  text-transform: uppercase;
}

.login-btn {
  width: 100%;
  padding: 16px;
  background: transparent;
  border: 1px solid var(--teal);
  color: var(--teal);
  font-family: 'Montserrat', sans-serif;
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 5px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-top: 4px;
}
.login-btn:hover {
  background: var(--teal);
  color: var(--bg-deep);
  box-shadow: 0 0 30px rgba(64,217,192,0.2);
}

.login-error {
  color: var(--red);
  font-family: 'Montserrat', sans-serif;
  font-size: 11px;
  margin-top: 16px;
  min-height: 18px;
  letter-spacing: 0.5px;
}

.login-footer {
  margin-top: 48px;
  font-family: 'Montserrat', sans-serif;
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text3);
  opacity: 0.6;
}

/* Down arrow animation like ethanmercados.com */
.login-arrow {
  position: absolute;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  color: var(--text3);
  font-size: 28px;
  animation: float 2.5s ease-in-out infinite;
  opacity: 0.4;
}
@keyframes float {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(8px); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app {
  display: none;
  height: 100%;
  flex-direction: column;
}
#app.active { display: flex; }

/* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  height: 54px;
  min-height: 54px;
  background: var(--bg-dark);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: stretch;
  z-index: 9999;
}

.brand {
  display: flex;
  align-items: center;
  padding: 0 24px;
  border-right: 1px solid var(--border);
  min-width: 200px;
  gap: 16px;
  cursor: default;
}
.brand img {
  height: 22px;
  opacity: 0.9;
}
.brand-sep {
  width: 1px;
  height: 18px;
  background: var(--border2);
}
.brand-label {
  font-family: 'Montserrat', sans-serif;
  font-size: 8.5px;
  font-weight: 500;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text3);
}

/* â”€â”€ NAV TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.nav-tabs {
  display: flex;
  align-items: stretch;
  flex: 1;
  overflow-x: auto;
}
.nav-tabs::-webkit-scrollbar { height: 0; }

.tab-btn {
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text3);
  font-family: 'Montserrat', sans-serif;
  font-size: 9.5px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 0 22px;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 8px;
}
.tab-btn:hover {
  color: var(--text2);
  background: rgba(64,217,192,0.02);
}
.tab-btn.active {
  color: var(--teal);
  border-bottom-color: var(--teal);
  background: var(--teal-dim);
}

.tab-icon { font-size: 13px; line-height: 1; }

/* â”€â”€ TOPBAR RIGHT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar-right {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 0 24px;
  border-left: 1px solid var(--border);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--text3);
}

.logout-btn {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text3);
  font-family: 'Montserrat', sans-serif;
  font-size: 8px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 5px 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.logout-btn:hover {
  color: var(--red);
  border-color: var(--red);
}

/* â”€â”€ IFRAMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.frame-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

.module-frame {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
  background: var(--bg-deep);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
.module-frame.active {
  opacity: 1;
  pointer-events: auto;
  z-index: 1;
}

/* â”€â”€ LOADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.frame-loader {
  position: absolute;
  inset: 0;
  background: var(--bg-deep);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10;
  transition: opacity 0.4s;
}
.frame-loader.hidden { opacity: 0; pointer-events: none; }

.loader-ring {
  width: 32px;
  height: 32px;
  border: 1.5px solid var(--border);
  border-top-color: var(--teal);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 14px;
}
@keyframes spin { to { transform: rotate(360deg); } }

.loader-text {
  font-family: 'Montserrat', sans-serif;
  font-size: 9px;
  letter-spacing: 3px;
  color: var(--text3);
  text-transform: uppercase;
}

/* â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.status-bar {
  height: 24px;
  min-height: 24px;
  background: var(--bg-dark);
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 24px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text3);
}
.status-dot {
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--teal);
  display: inline-block;
  animation: pulse-dot 2.5s ease-in-out infinite;
}
@keyframes pulse-dot {
  0%, 100% { opacity: 0.9; }
  50% { opacity: 0.2; }
}

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 900px) {
  .tab-btn { padding: 0 12px; font-size: 8.5px; }
  .tab-btn .tab-label { display: none; }
  .tab-btn .tab-icon { font-size: 16px; }
  .brand { min-width: auto; padding: 0 14px; }
  .brand img { height: 18px; }
  .brand-sep, .brand-label { display: none; }
  .topbar-right span { display: none; }
  .login-heading { font-size: 38px; }
}
@media (max-width: 600px) {
  .tab-btn { padding: 0 8px; }
  .topbar-right { padding: 0 10px; }
  .login-heading { font-size: 32px; }
  .login-box { width: 100%; }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN SCREEN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <img src="https://ethanmercados.com/wp-content/uploads/2024/03/logo-ethan-mercados-negativo.png"
         alt="ethan mercados" class="login-logo-img"
         onerror="this.style.display='none';document.getElementById('fallback-logo').style.display='block';">
    <div id="fallback-logo" style="display:none;font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:400;color:var(--text1);letter-spacing:4px;margin-bottom:40px;">ethan <span style='color:var(--teal)'>mercados</span></div>

    <div class="login-heading">InversiÃ³n <em>consciente</em></div>
    <div class="login-subtitle">Invierte <em>Crece</em> Disfruta</div>

    <div class="login-field">
      <input type="password" id="login-pass" placeholder="ContraseÃ±a" autofocus
             onkeydown="if(event.key==='Enter') doLogin()">
    </div>
    <button class="login-btn" onclick="doLogin()">Acceder a Plataforma</button>
    <div class="login-error" id="login-error"></div>
    <div class="login-footer">Plataforma privada Â· Acceso restringido</div>
  </div>
  <div class="login-arrow">â†“</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SHELL
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <div class="topbar">
    <div class="brand">
      <img src="https://ethanmercados.com/wp-content/uploads/2024/03/logo-ethan-mercados-negativo.png"
           alt="ethan mercados"
           onerror="this.outerHTML='<span style=&quot;font-family:Cormorant Garamond,serif;font-size:16px;color:var(--text1);letter-spacing:2px;&quot;>ethan mercados</span>'">
      <div class="brand-sep"></div>
      <div class="brand-label">Plataforma</div>
    </div>

    <div class="nav-tabs">
      <button class="tab-btn active" onclick="switchTab('macro')" id="tab-macro">
        <span class="tab-icon">â—‰</span>
        <span class="tab-label">Macro</span>
      </button>
      <button class="tab-btn" onclick="switchTab('allocation')" id="tab-allocation">
        <span class="tab-icon">ğŸ’¼</span>
        <span class="tab-label">Asset Allocation</span>
      </button>
      <button class="tab-btn" onclick="switchTab('sectors')" id="tab-sectors">
        <span class="tab-icon">ğŸ­</span>
        <span class="tab-label">Sectores</span>
      </button>
      <button class="tab-btn" onclick="switchTab('sp500')" id="tab-sp500">
        <span class="tab-icon">ğŸ”</span>
        <span class="tab-label">S&P 500</span>
      </button>
      <button class="tab-btn" onclick="switchTab('screener')" id="tab-screener">
        <span class="tab-icon">â—†</span>
        <span class="tab-label">Screener</span>
      </button>
      <button class="tab-btn" onclick="switchTab('portfolio')" id="tab-portfolio">
        <span class="tab-icon">â—«</span>
        <span class="tab-label">Cartera</span>
      </button>
      <button class="tab-btn" onclick="switchTab('fundamental')" id="tab-fundamental">
        <span class="tab-icon">â–¤</span>
        <span class="tab-label">Fundamental</span>
      </button>
    </div>

    <div class="topbar-right">
      <span id="clock">â€”</span>
      <button class="logout-btn" onclick="doLogout()">Salir</button>
    </div>
  </div>

  <div class="frame-area">
    <div class="frame-loader" id="loader">
      <div class="loader-ring"></div>
      <div class="loader-text">Cargando mÃ³dulo...</div>
    </div>
    <iframe class="module-frame" id="frame-screener"  src="ethan-app.html"></iframe>
    <iframe class="module-frame"        id="frame-sp500"     srcdoc="<!DOCTYPE html>
<html lang=&quot;es&quot;>
<head>
<meta charset=&quot;UTF-8&quot;>
<meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
<title>ETHAN Â· Screener S&amp;P 500</title>
<style>
:root {
  --bg: #06080c;
  --s1: #0d1117;
  --s2: #161b22;
  --border: #1c2535;
  --green: #00ff87;
  --red: #ff3b5c;
  --yellow: #fbbf24;
  --text: #d4dbe8;
  --text2: #5a6478;
  --text3: #2e3440;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  padding: 24px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.title {
  font-size: 24px;
  font-weight: 600;
  letter-spacing: 2px;
}

.subtitle {
  font-size: 11px;
  color: var(--text2);
  margin-top: 4px;
  letter-spacing: 1px;
}

.controls {
  display: flex;
  gap: 12px;
  align-items: center;
}

.btn {
  background: var(--green);
  color: var(--bg);
  border: none;
  padding: 10px 20px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  transition: opacity 0.2s;
}

.btn:hover { opacity: 0.9; }
.btn:disabled { opacity: 0.3; cursor: not-allowed; }

.status {
  font-size: 11px;
  color: var(--text2);
  letter-spacing: 1px;
}

.progress-bar {
  height: 4px;
  background: var(--s2);
  margin-bottom: 20px;
  overflow: hidden;
  display: none;
}

.progress-bar.active { display: block; }

.progress-fill {
  height: 100%;
  background: var(--green);
  transition: width 0.3s;
}

.filters {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filter {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
}

.filter label {
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.filter select, .filter input {
  background: var(--s1);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 6px 10px;
  font-family: inherit;
  font-size: 11px;
}

.results-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
}

.results-table thead {
  background: var(--s2);
  position: sticky;
  top: 0;
  z-index: 10;
}

.results-table th {
  padding: 10px 12px;
  text-align: left;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text2);
  border-bottom: 1px solid var(--border);
}

.results-table td {
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
}

.results-table tr:hover {
  background: var(--s1);
}

.ticker-cell {
  font-weight: 600;
  font-size: 13px;
  letter-spacing: 1px;
}

.score-cell {
  font-weight: 700;
  font-size: 16px;
}

.score-green { color: var(--green); }
.score-yellow { color: var(--yellow); }
.score-gray { color: var(--text2); }

.estado-listo { color: var(--green); }
.estado-espera { color: var(--yellow); }
.estado-cerca { color: var(--text2); }

.sector-cell {
  font-size: 10px;
  opacity: 0.7;
}

.sector-strong {
  color: var(--green);
  opacity: 1;
  font-weight: 600;
}

.btn-add {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text2);
  padding: 4px 10px;
  font-size: 10px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-add:hover {
  border-color: var(--green);
  color: var(--green);
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border);
  border-top-color: var(--green);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  margin-right: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<div class=&quot;header&quot;>
  <div>
    <div class=&quot;title&quot;>ğŸ” SCREENER S&amp;P 500</div>
    <div class=&quot;subtitle&quot;>Escaneo automÃ¡tico de oportunidades</div>
  </div>
  <div class=&quot;controls&quot;>
    <span class=&quot;status&quot; id=&quot;status&quot;>Listo</span>
    <button class=&quot;btn&quot; onclick=&quot;startScan()&quot; id=&quot;scanBtn&quot;>ESCANEAR</button>
  </div>
</div>

<div class=&quot;progress-bar&quot; id=&quot;progressBar&quot;>
  <div class=&quot;progress-fill&quot; id=&quot;progressFill&quot;></div>
</div>

<div class=&quot;filters&quot;>
  <div class=&quot;filter&quot;>
    <label>Score MÃ­nimo:</label>
    <select id=&quot;filterScore&quot; onchange=&quot;renderResults()&quot;>
      <option value=&quot;0&quot;>Todos</option>
      <option value=&quot;6&quot;>â‰¥ 6</option>
      <option value=&quot;7&quot; selected>â‰¥ 7</option>
      <option value=&quot;8&quot;>â‰¥ 8</option>
      <option value=&quot;9&quot;>â‰¥ 9</option>
      <option value=&quot;10&quot;>= 10</option>
    </select>
  </div>
  <div class=&quot;filter&quot;>
    <label>Estado:</label>
    <select id=&quot;filterEstado&quot; onchange=&quot;renderResults()&quot;>
      <option value=&quot;all&quot;>Todos</option>
      <option value=&quot;ready&quot;>Solo LISTO</option>
      <option value=&quot;diario&quot;>Espera Diario</option>
      <option value=&quot;close&quot;>Cerca</option>
    </select>
  </div>
  <div class=&quot;filter&quot;>
    <label>Sector:</label>
    <select id=&quot;filterSector&quot; onchange=&quot;renderResults()&quot;>
      <option value=&quot;all&quot;>Todos</option>
      <option value=&quot;XLK&quot;>Technology</option>
      <option value=&quot;XLF&quot;>Financials</option>
      <option value=&quot;XLV&quot;>Health Care</option>
      <option value=&quot;XLE&quot;>Energy</option>
      <option value=&quot;XLY&quot;>Consumer Discr.</option>
      <option value=&quot;XLP&quot;>Consumer Staples</option>
      <option value=&quot;XLI&quot;>Industrials</option>
      <option value=&quot;XLB&quot;>Materials</option>
      <option value=&quot;XLU&quot;>Utilities</option>
      <option value=&quot;XLRE&quot;>Real Estate</option>
      <option value=&quot;XLC&quot;>Communication</option>
    </select>
  </div>
</div>

<div id=&quot;resultsContainer&quot;>
  <div class=&quot;empty-state&quot;>
    <div>Haz clic en <strong>ESCANEAR</strong> para buscar oportunidades en el S&amp;P 500</div>
  </div>
</div>

<script>
// Lista del S&amp;P 500
const SP500 = [&quot;MMM&quot;,&quot;AOS&quot;,&quot;ABT&quot;,&quot;ABBV&quot;,&quot;ACN&quot;,&quot;ADBE&quot;,&quot;AMD&quot;,&quot;AES&quot;,&quot;AFL&quot;,&quot;A&quot;,&quot;APD&quot;,&quot;ABNB&quot;,&quot;AKAM&quot;,&quot;ALB&quot;,&quot;ARE&quot;,&quot;ALGN&quot;,&quot;ALLE&quot;,&quot;LNT&quot;,&quot;ALL&quot;,&quot;GOOGL&quot;,&quot;GOOG&quot;,&quot;MO&quot;,&quot;AMZN&quot;,&quot;AMCR&quot;,&quot;AEE&quot;,&quot;AAL&quot;,&quot;AEP&quot;,&quot;AXP&quot;,&quot;AIG&quot;,&quot;AMT&quot;,&quot;AWK&quot;,&quot;AMP&quot;,&quot;AME&quot;,&quot;AMGN&quot;,&quot;APH&quot;,&quot;ADI&quot;,&quot;ANSS&quot;,&quot;AON&quot;,&quot;APA&quot;,&quot;AAPL&quot;,&quot;AMAT&quot;,&quot;APTV&quot;,&quot;ACGL&quot;,&quot;ADM&quot;,&quot;ANET&quot;,&quot;AJG&quot;,&quot;AIZ&quot;,&quot;T&quot;,&quot;ATO&quot;,&quot;ADSK&quot;,&quot;ADP&quot;,&quot;AZO&quot;,&quot;AVB&quot;,&quot;AVY&quot;,&quot;AXON&quot;,&quot;BKR&quot;,&quot;BALL&quot;,&quot;BAC&quot;,&quot;BBWI&quot;,&quot;BAX&quot;,&quot;BDX&quot;,&quot;BRK-B&quot;,&quot;BBY&quot;,&quot;TECH&quot;,&quot;BIIB&quot;,&quot;BIO&quot;,&quot;BLK&quot;,&quot;BX&quot;,&quot;BK&quot;,&quot;BA&quot;,&quot;BKNG&quot;,&quot;BWA&quot;,&quot;BSX&quot;,&quot;BMY&quot;,&quot;AVGO&quot;,&quot;BR&quot;,&quot;BRO&quot;,&quot;BF-B&quot;,&quot;BG&quot;,&quot;CHRW&quot;,&quot;CDNS&quot;,&quot;CZR&quot;,&quot;CPT&quot;,&quot;CPB&quot;,&quot;COF&quot;,&quot;CAH&quot;,&quot;KMX&quot;,&quot;CCL&quot;,&quot;CARR&quot;,&quot;CTLT&quot;,&quot;CAT&quot;,&quot;CBOE&quot;,&quot;CBRE&quot;,&quot;CDW&quot;,&quot;CE&quot;,&quot;COR&quot;,&quot;CNC&quot;,&quot;CNP&quot;,&quot;CF&quot;,&quot;CHTR&quot;,&quot;CVX&quot;,&quot;CMG&quot;,&quot;CB&quot;,&quot;CHD&quot;,&quot;CI&quot;,&quot;CINF&quot;,&quot;CTAS&quot;,&quot;CSCO&quot;,&quot;C&quot;,&quot;CFG&quot;,&quot;CLX&quot;,&quot;CME&quot;,&quot;CMS&quot;,&quot;KO&quot;,&quot;CTSH&quot;,&quot;CL&quot;,&quot;CMCSA&quot;,&quot;CMA&quot;,&quot;CAG&quot;,&quot;COP&quot;,&quot;ED&quot;,&quot;STZ&quot;,&quot;CEG&quot;,&quot;COO&quot;,&quot;CPRT&quot;,&quot;GLW&quot;,&quot;CPAY&quot;,&quot;CTVA&quot;,&quot;CSGP&quot;,&quot;COST&quot;,&quot;CTRA&quot;,&quot;CRWD&quot;,&quot;CCI&quot;,&quot;CSX&quot;,&quot;CMI&quot;,&quot;CVS&quot;,&quot;DHR&quot;,&quot;DRI&quot;,&quot;DVA&quot;,&quot;DAY&quot;,&quot;DECK&quot;,&quot;DE&quot;,&quot;DELL&quot;,&quot;DAL&quot;,&quot;DVN&quot;,&quot;DXCM&quot;,&quot;FANG&quot;,&quot;DLR&quot;,&quot;DFS&quot;,&quot;DG&quot;,&quot;DLTR&quot;,&quot;D&quot;,&quot;DPZ&quot;,&quot;DOV&quot;,&quot;DOW&quot;,&quot;DHI&quot;,&quot;DTE&quot;,&quot;DUK&quot;,&quot;DD&quot;,&quot;EMN&quot;,&quot;ETN&quot;,&quot;EBAY&quot;,&quot;ECL&quot;,&quot;EIX&quot;,&quot;EW&quot;,&quot;EA&quot;,&quot;ELV&quot;,&quot;EMR&quot;,&quot;ENPH&quot;,&quot;ETR&quot;,&quot;EOG&quot;,&quot;EPAM&quot;,&quot;EQT&quot;,&quot;EFX&quot;,&quot;EQIX&quot;,&quot;EQR&quot;,&quot;ESS&quot;,&quot;EL&quot;,&quot;ETSY&quot;,&quot;EG&quot;,&quot;EVRG&quot;,&quot;ES&quot;,&quot;EXC&quot;,&quot;EXPE&quot;,&quot;EXPD&quot;,&quot;EXR&quot;,&quot;XOM&quot;,&quot;FFIV&quot;,&quot;FDS&quot;,&quot;FICO&quot;,&quot;FAST&quot;,&quot;FRT&quot;,&quot;FDX&quot;,&quot;FITB&quot;,&quot;FSLR&quot;,&quot;FE&quot;,&quot;FIS&quot;,&quot;FI&quot;,&quot;FLT&quot;,&quot;FMC&quot;,&quot;F&quot;,&quot;FTNT&quot;,&quot;FTV&quot;,&quot;FOXA&quot;,&quot;FOX&quot;,&quot;BEN&quot;,&quot;FCX&quot;,&quot;GRMN&quot;,&quot;IT&quot;,&quot;GE&quot;,&quot;GEHC&quot;,&quot;GEN&quot;,&quot;GD&quot;,&quot;GIS&quot;,&quot;GM&quot;,&quot;GPC&quot;,&quot;GILD&quot;,&quot;GPN&quot;,&quot;GL&quot;,&quot;GDDY&quot;,&quot;GS&quot;,&quot;HAL&quot;,&quot;HIG&quot;,&quot;HAS&quot;,&quot;HCA&quot;,&quot;DOC&quot;,&quot;HSIC&quot;,&quot;HSY&quot;,&quot;HES&quot;,&quot;HPE&quot;,&quot;HLT&quot;,&quot;HOLX&quot;,&quot;HD&quot;,&quot;HON&quot;,&quot;HRL&quot;,&quot;HST&quot;,&quot;HWM&quot;,&quot;HPQ&quot;,&quot;HUBB&quot;,&quot;HUM&quot;,&quot;HBAN&quot;,&quot;HII&quot;,&quot;IBM&quot;,&quot;IEX&quot;,&quot;IDXX&quot;,&quot;ITW&quot;,&quot;INCY&quot;,&quot;IR&quot;,&quot;PODD&quot;,&quot;INTC&quot;,&quot;ICE&quot;,&quot;IFF&quot;,&quot;IP&quot;,&quot;IPG&quot;,&quot;INTU&quot;,&quot;ISRG&quot;,&quot;IVZ&quot;,&quot;INVH&quot;,&quot;IQV&quot;,&quot;IRM&quot;,&quot;JBHT&quot;,&quot;JBL&quot;,&quot;JKHY&quot;,&quot;J&quot;,&quot;JNJ&quot;,&quot;JCI&quot;,&quot;JPM&quot;,&quot;JNPR&quot;,&quot;K&quot;,&quot;KVUE&quot;,&quot;KDP&quot;,&quot;KEY&quot;,&quot;KEYS&quot;,&quot;KMB&quot;,&quot;KIM&quot;,&quot;KMI&quot;,&quot;KKR&quot;,&quot;KLAC&quot;,&quot;KHC&quot;,&quot;KR&quot;,&quot;LHX&quot;,&quot;LH&quot;,&quot;LRCX&quot;,&quot;LW&quot;,&quot;LVS&quot;,&quot;LDOS&quot;,&quot;LEN&quot;,&quot;LIN&quot;,&quot;LYV&quot;,&quot;LKQ&quot;,&quot;LMT&quot;,&quot;L&quot;,&quot;LOW&quot;,&quot;LULU&quot;,&quot;LYB&quot;,&quot;MTB&quot;,&quot;MRO&quot;,&quot;MPC&quot;,&quot;MKTX&quot;,&quot;MAR&quot;,&quot;MMC&quot;,&quot;MLM&quot;,&quot;MAS&quot;,&quot;MA&quot;,&quot;MTCH&quot;,&quot;MKC&quot;,&quot;MCD&quot;,&quot;MCK&quot;,&quot;MDT&quot;,&quot;MRK&quot;,&quot;META&quot;,&quot;MET&quot;,&quot;MTD&quot;,&quot;MGM&quot;,&quot;MCHP&quot;,&quot;MU&quot;,&quot;MSFT&quot;,&quot;MAA&quot;,&quot;MRNA&quot;,&quot;MHK&quot;,&quot;MOH&quot;,&quot;TAP&quot;,&quot;MDLZ&quot;,&quot;MPWR&quot;,&quot;MNST&quot;,&quot;MCO&quot;,&quot;MS&quot;,&quot;MOS&quot;,&quot;MSI&quot;,&quot;MSCI&quot;,&quot;NDAQ&quot;,&quot;NTAP&quot;,&quot;NFLX&quot;,&quot;NEM&quot;,&quot;NWSA&quot;,&quot;NWS&quot;,&quot;NEE&quot;,&quot;NKE&quot;,&quot;NI&quot;,&quot;NDSN&quot;,&quot;NSC&quot;,&quot;NTRS&quot;,&quot;NOC&quot;,&quot;NCLH&quot;,&quot;NRG&quot;,&quot;NUE&quot;,&quot;NVDA&quot;,&quot;NVR&quot;,&quot;NXPI&quot;,&quot;ORLY&quot;,&quot;OXY&quot;,&quot;ODFL&quot;,&quot;OMC&quot;,&quot;ON&quot;,&quot;OKE&quot;,&quot;ORCL&quot;,&quot;OTIS&quot;,&quot;PCAR&quot;,&quot;PKG&quot;,&quot;PANW&quot;,&quot;PARA&quot;,&quot;PH&quot;,&quot;PAYX&quot;,&quot;PAYC&quot;,&quot;PYPL&quot;,&quot;PNR&quot;,&quot;PEP&quot;,&quot;PFE&quot;,&quot;PCG&quot;,&quot;PM&quot;,&quot;PSX&quot;,&quot;PNW&quot;,&quot;PNC&quot;,&quot;POOL&quot;,&quot;PPG&quot;,&quot;PPL&quot;,&quot;PFG&quot;,&quot;PG&quot;,&quot;PGR&quot;,&quot;PLD&quot;,&quot;PRU&quot;,&quot;PEG&quot;,&quot;PTC&quot;,&quot;PSA&quot;,&quot;PHM&quot;,&quot;QRVO&quot;,&quot;PWR&quot;,&quot;QCOM&quot;,&quot;DGX&quot;,&quot;RL&quot;,&quot;RJF&quot;,&quot;RTX&quot;,&quot;O&quot;,&quot;REG&quot;,&quot;REGN&quot;,&quot;RF&quot;,&quot;RSG&quot;,&quot;RMD&quot;,&quot;RVTY&quot;,&quot;ROK&quot;,&quot;ROL&quot;,&quot;ROP&quot;,&quot;ROST&quot;,&quot;RCL&quot;,&quot;SPGI&quot;,&quot;CRM&quot;,&quot;SBAC&quot;,&quot;SLB&quot;,&quot;STX&quot;,&quot;SRE&quot;,&quot;NOW&quot;,&quot;SHW&quot;,&quot;SPG&quot;,&quot;SWKS&quot;,&quot;SJM&quot;,&quot;SW&quot;,&quot;SNA&quot;,&quot;SOLV&quot;,&quot;SO&quot;,&quot;LUV&quot;,&quot;SWK&quot;,&quot;SBUX&quot;,&quot;STT&quot;,&quot;STLD&quot;,&quot;STE&quot;,&quot;SYK&quot;,&quot;SMCI&quot;,&quot;SYF&quot;,&quot;SNPS&quot;,&quot;SYY&quot;,&quot;TMUS&quot;,&quot;TROW&quot;,&quot;TTWO&quot;,&quot;TPR&quot;,&quot;TRGP&quot;,&quot;TGT&quot;,&quot;TEL&quot;,&quot;TDY&quot;,&quot;TFX&quot;,&quot;TER&quot;,&quot;TSLA&quot;,&quot;TXN&quot;,&quot;TXT&quot;,&quot;TMO&quot;,&quot;TJX&quot;,&quot;TSCO&quot;,&quot;TT&quot;,&quot;TDG&quot;,&quot;TRV&quot;,&quot;TRMB&quot;,&quot;TFC&quot;,&quot;TYL&quot;,&quot;TSN&quot;,&quot;USB&quot;,&quot;UBER&quot;,&quot;UDR&quot;,&quot;ULTA&quot;,&quot;UNP&quot;,&quot;UAL&quot;,&quot;UPS&quot;,&quot;URI&quot;,&quot;UNH&quot;,&quot;UHS&quot;,&quot;VLO&quot;,&quot;VTR&quot;,&quot;VRSN&quot;,&quot;VRSK&quot;,&quot;VZ&quot;,&quot;VRTX&quot;,&quot;VLTO&quot;,&quot;VFC&quot;,&quot;VTRS&quot;,&quot;VICI&quot;,&quot;V&quot;,&quot;VST&quot;,&quot;VMC&quot;,&quot;WRB&quot;,&quot;GWW&quot;,&quot;WAB&quot;,&quot;WBA&quot;,&quot;WMT&quot;,&quot;DIS&quot;,&quot;WBD&quot;,&quot;WM&quot;,&quot;WAT&quot;,&quot;WEC&quot;,&quot;WFC&quot;,&quot;WELL&quot;,&quot;WST&quot;,&quot;WDC&quot;,&quot;WY&quot;,&quot;WMB&quot;,&quot;WTW&quot;,&quot;WYNN&quot;,&quot;XEL&quot;,&quot;XYL&quot;,&quot;YUM&quot;,&quot;ZBRA&quot;,&quot;ZBH&quot;,&quot;ZTS&quot;];

// Mapeo de sectores (principales del S&amp;P 500)
const SECTOR_MAP = {
  'AAPL':'XLK','MSFT':'XLK','NVDA':'XLK','AVGO':'XLK','ADBE':'XLK','CRM':'XLK','CSCO':'XLK','ACN':'XLK','AMD':'XLK','INTC':'XLK','QCOM':'XLK','INTU':'XLK','AMAT':'XLK','TXN':'XLK','NOW':'XLK','PANW':'XLK','SNPS':'XLK','CDNS':'XLK',
  'BRK-B':'XLF','JPM':'XLF','V':'XLF','MA':'XLF','BAC':'XLF','WFC':'XLF','GS':'XLF','MS':'XLF','AXP':'XLF','C':'XLF','BLK':'XLF','SPGI':'XLF','PGR':'XLF','CB':'XLF','MMC':'XLF',
  'LLY':'XLV','UNH':'XLV','JNJ':'XLV','ABBV':'XLV','MRK':'XLV','TMO':'XLV','ABT':'XLV','DHR':'XLV','PFE':'XLV','BMY':'XLV','AMGN':'XLV','GILD':'XLV','CVS':'XLV','ISRG':'XLV','VRTX':'XLV',
  'XOM':'XLE','CVX':'XLE','COP':'XLE','SLB':'XLE','EOG':'XLE','MPC':'XLE','PSX':'XLE','VLO':'XLE','OXY':'XLE','HAL':'XLE',
  'AMZN':'XLY','TSLA':'XLY','HD':'XLY','MCD':'XLY','NKE':'XLY','LOW':'XLY','SBUX':'XLY','TJX':'XLY','BKNG':'XLY','CMG':'XLY',
  'PG':'XLP','KO':'XLP','PEP':'XLP','COST':'XLP','WMT':'XLP','PM':'XLP','MO':'XLP','MDLZ':'XLP','CL':'XLP','KMB':'XLP',
  'CAT':'XLI','RTX':'XLI','HON':'XLI','UNP':'XLI','BA':'XLI','GE':'XLI','LMT':'XLI','DE':'XLI','UPS':'XLI','ETN':'XLI',
  'LIN':'XLB','APD':'XLB','SHW':'XLB','FCX':'XLB','ECL':'XLB','NEM':'XLB','DOW':'XLB','DD':'XLB',
  'NEE':'XLU','SO':'XLU','DUK':'XLU','CEG':'XLU','SRE':'XLU','AEP':'XLU','D':'XLU','PEG':'XLU',
  'PLD':'XLRE','AMT':'XLRE','EQIX':'XLRE','CCI':'XLRE','PSA':'XLRE','DLR':'XLRE','O':'XLRE',
  'META':'XLC','GOOGL':'XLC','GOOG':'XLC','NFLX':'XLC','DIS':'XLC','CMCSA':'XLC','T':'XLC','VZ':'XLC','TMUS':'XLC'
};

const SECTOR_NAMES = {
  'XLK':'Tech','XLF':'Financials','XLV':'Health','XLE':'Energy','XLY':'Consumer D','XLP':'Consumer S','XLI':'Industrials','XLB':'Materials','XLU':'Utilities','XLRE':'Real Estate','XLC':'Comm'
};

let scanResults = [];
let scanning = false;

// Indicadores (copiados del sistema ETHAN)
function sma(arr,p){return arr.map((_,i)=>{if(i<p-1)return null;const sl=arr.slice(i-p+1,i+1).filter(v=>v!=null&amp;&amp;!isNaN(v));return sl.length===p?sl.reduce((a,b)=>a+b,0)/p:null;});}
function ema(arr,p){const k=2/(p+1),out=new Array(arr.length).fill(null);let s=arr.findIndex(v=>v!=null&amp;&amp;!isNaN(v));if(s<0)return out;out[s]=arr[s];for(let i=s+1;i<arr.length;i++){const v=(arr[i]!=null&amp;&amp;!isNaN(arr[i]))?arr[i]:out[i-1];out[i]=v*k+out[i-1]*(1-k);}return out;}
function macd(closes){const ef=ema(closes,12),es=ema(closes,26);const m=ef.map((v,i)=>(v!=null&amp;&amp;es[i]!=null)?v-es[i]:null);const sl=ema(m.map(v=>v??0),9);return{m,sl};}
function rsi(closes,p=14){const out=new Array(closes.length).fill(null);if(closes.length<p+1)return out;let g=0,l=0;for(let i=1;i<=p;i++){const d=closes[i]-closes[i-1];d>0?g+=d:l-=d;}let ag=g/p,al=l/p;out[p]=al===0?100:100-(100/(1+ag/al));for(let i=p+1;i<closes.length;i++){const d=closes[i]-closes[i-1];ag=(ag*(p-1)+(d>0?d:0))/p;al=(al*(p-1)+(d<0?-d:0))/p;out[i]=al===0?100:100-(100/(1+ag/al));}return out;}
function stoch(highs,lows,closes,p){const rawK=closes.map((c,i)=>{if(i<p-1)return null;const hh=Math.max(...highs.slice(i-p+1,i+1));const ll=Math.min(...lows.slice(i-p+1,i+1));return hh===ll?50:(c-ll)/(hh-ll)*100;});const k=sma(rawK,3);const d=sma(k.map(v=>v??0),3);return{k,d};}
function resample(ts,opens,highs,lows,closes,vols,freq){const groups={};ts.forEach((t,i)=>{const dd=new Date(t*1000);let key;if(freq==='W'){const day=dd.getDay();const diff=dd.getDate()-day+(day===0?-6:1);const mo=new Date(+dd);mo.setDate(diff);key=mo.toISOString().slice(0,10);}else{key=`${dd.getFullYear()}-${String(dd.getMonth()+1).padStart(2,'0')}`;}if(!groups[key]){groups[key]={o:opens[i],h:highs[i],l:lows[i],c:closes[i],v:vols[i]};}else{groups[key].h=Math.max(groups[key].h,highs[i]);groups[key].l=Math.min(groups[key].l,lows[i]);groups[key].c=closes[i];groups[key].v+=vols[i];}});const keys=Object.keys(groups).sort();return{dates:keys,opens:keys.map(k=>groups[k].o),highs:keys.map(k=>groups[k].h),lows:keys.map(k=>groups[k].l),closes:keys.map(k=>groups[k].c),vols:keys.map(k=>groups[k].v)};}

async function fetchData(ticker){
  const yUrl=`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&amp;range=10y&amp;events=history`;
  const proxies=[
    u=>`https://corsproxy.io/?${encodeURIComponent(u)}`,
    u=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
    u=>`https://thingproxy.freeboard.io/fetch/${u}`,
  ];
  let lastErr;
  for(const fn of proxies){
    try{
      const r=await fetch(fn(yUrl),{signal:AbortSignal.timeout(12000)});
      if(!r.ok)throw new Error(`HTTP ${r.status}`);
      const j=JSON.parse(await r.text());
      if(j.chart?.error)throw new Error(j.chart.error.description);
      const res=j.chart.result[0];
      const q=res.indicators.quote[0];
      const adj=res.indicators.adjclose?.[0]?.adjclose||q.close;
      const ratio=adj.map((a,i)=>(q.close[i]&amp;&amp;a)?a/q.close[i]:1);
      return{
        timestamps:res.timestamp,
        opens:q.open.map((v,i)=>v*ratio[i]),
        highs:q.high.map((v,i)=>v*ratio[i]),
        lows:q.low.map((v,i)=>v*ratio[i]),
        closes:adj,
        vols:q.volume,
      };
    }catch(e){lastErr=e;}
  }
  throw lastErr||new Error('Sin conexiÃ³n');
}

function analyzeQuick(raw){
  const{timestamps,opens,highs,lows,closes,vols}=raw;
  const n=closes.length;
  const W=resample(timestamps,opens,highs,lows,closes,vols,'W');
  const M=resample(timestamps,opens,highs,lows,closes,vols,'M');
  
  const m_macd=macd(M.closes);
  const m_s89=stoch(M.highs,M.lows,M.closes,89);
  const m_s8=stoch(M.highs,M.lows,M.closes,8);
  const m_rsi=rsi(M.closes,14);
  const m_sma10=sma(M.closes,10);
  const mi=M.closes.length-1;
  
  const w_macd=macd(W.closes);
  const w_s89=stoch(W.highs,W.lows,W.closes,89);
  const w_rsi=rsi(W.closes,14);
  const w_sma20=sma(W.closes,20);
  const wi=W.closes.length-1;
  
  const d_macd=macd(closes);
  const d_rsi=rsi(closes,14);
  const di=n-1;
  
  let score=0;
  const mc_ok=[
    m_macd.m[mi]>0&amp;&amp;m_macd.m[mi]>m_macd.sl[mi],
    (m_s89.k[mi]>80&amp;&amp;m_s89.k[mi]>m_s89.d[mi])||m_s89.k[mi]>92,
    m_rsi[mi]>65,
    m_s8.k[mi]>78,
    m_sma10[mi]&amp;&amp;M.closes[mi]>m_sma10[mi]
  ];
  const sc_ok=[
    w_macd.m[wi]>0&amp;&amp;w_macd.m[wi]>w_macd.sl[wi],
    (w_s89.k[wi]>85&amp;&amp;w_s89.k[wi]>w_s89.d[wi])||w_s89.k[wi]>92,
    w_rsi[wi]>67,
    w_sma20[wi]&amp;&amp;W.closes[wi]>w_sma20[wi]
  ];
  
  score=mc_ok.filter(x=>x).length+sc_ok.filter(x=>x).length;
  
  const mensualOk=mc_ok.every(x=>x);
  const semanalOk=sc_ok.every(x=>x);
  const dailyReady=d_macd.m[di]>d_macd.sl[di]&amp;&amp;d_macd.m[di-1]<=d_macd.sl[di-1]&amp;&amp;d_rsi[di]>57&amp;&amp;d_macd.m[di]>0;
  
  let estado='watching';
  if(mensualOk&amp;&amp;semanalOk&amp;&amp;dailyReady)estado='ready';
  else if(mensualOk&amp;&amp;semanalOk)estado='diario';
  else if(score>=7)estado='close';
  
  return{score,estado,price:closes[di]};
}

async function startScan(){
  if(scanning)return;
  scanning=true;
  scanResults=[];
  
  const btn=document.getElementById('scanBtn');
  const status=document.getElementById('status');
  const progress=document.getElementById('progressBar');
  const fill=document.getElementById('progressFill');
  
  btn.disabled=true;
  progress.classList.add('active');
  fill.style.width='0%';
  
  document.getElementById('resultsContainer').innerHTML=`
    <div class=&quot;empty-state&quot;>
      <div class=&quot;spinner&quot;></div>
      <div>Escaneando S&amp;P 500...</div>
    </div>
  `;
  
  for(let i=0;i<SP500.length;i++){
    const ticker=SP500[i];
    const pct=((i+1)/SP500.length*100).toFixed(1);
    
    fill.style.width=pct+'%';
    status.textContent=`${ticker} (${i+1}/${SP500.length})`;
    
    try{
      const raw=await fetchData(ticker);
      const result=analyzeQuick(raw);
      result.ticker=ticker;
      result.sector=SECTOR_MAP[ticker]||null;
      scanResults.push(result);
      
      if(result.score>=7){
        renderResults();
      }
    }catch(err){
      // Ignorar errores y continuar
    }
  }
  
  scanning=false;
  btn.disabled=false;
  progress.classList.remove('active');
  status.textContent=`Completado: ${scanResults.length} valores escaneados`;
  renderResults();
}

function renderResults(){
  const minScore=parseInt(document.getElementById('filterScore').value);
  const filterEstado=document.getElementById('filterEstado').value;
  const filterSector=document.getElementById('filterSector').value;
  
  let filtered=scanResults.filter(r=>{
    if(r.score<minScore)return false;
    if(filterEstado!=='all'&amp;&amp;r.estado!==filterEstado)return false;
    if(filterSector!=='all'&amp;&amp;r.sector!==filterSector)return false;
    return true;
  });
  
  filtered.sort((a,b)=>b.score-a.score);
  
  if(filtered.length===0){
    document.getElementById('resultsContainer').innerHTML=`
      <div class=&quot;empty-state&quot;>
        <div>No se encontraron valores que cumplan los filtros</div>
      </div>
    `;
    return;
  }
  
  const rows=filtered.map(r=>{
    const scoreClass=r.score>=9?'score-green':r.score>=7?'score-yellow':'score-gray';
    const estadoClass=r.estado==='ready'?'estado-listo':r.estado==='diario'?'estado-espera':'estado-cerca';
    const estadoText={'ready':'ğŸŸ¢ LISTO','diario':'â³ ESPERA DIARIO','close':'ğŸ”¶ CERCA','watching':'ğŸ‘ VIGILANDO'}[r.estado];
    
    return`
      <tr>
        <td class=&quot;ticker-cell&quot;>${r.ticker}</td>
        <td class=&quot;sector-cell&quot;>${r.sector?SECTOR_NAMES[r.sector]:'-'}</td>
        <td class=&quot;score-cell ${scoreClass}&quot;>${r.score}/10</td>
        <td class=&quot;${estadoClass}&quot;>${estadoText}</td>
        <td>${r.price?r.price.toFixed(2):'-'}</td>
        <td><button class=&quot;btn-add&quot; onclick=&quot;addToWatchlist('${r.ticker}')&quot;>+ Watchlist</button></td>
      </tr>
    `;
  }).join('');
  
  document.getElementById('resultsContainer').innerHTML=`
    <table class=&quot;results-table&quot;>
      <thead>
        <tr>
          <th>TICKER</th>
          <th>SECTOR</th>
          <th>SCORE</th>
          <th>ESTADO</th>
          <th>PRECIO</th>
          <th>ACCIÃ“N</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `;
}

function addToWatchlist(ticker){
  alert(`${ticker} aÃ±adido al watchlist (funciÃ³n pendiente de implementar)`);
}

// Auto-escanear al cargar
window.addEventListener('load',()=>{
  setTimeout(startScan,1000);
});
</script>
</body>
</html>
"></iframe>
    <iframe class="module-frame active" id="frame-macro"      srcdoc="<!DOCTYPE html>
<html lang=&quot;es&quot;>
<head>
<meta charset=&quot;UTF-8&quot;>
<meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
<title>Dashboard Macro AutomÃ¡tico</title>
<script src=&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;></script>
<style>
:root {
  --bg: #06080c;
  --s1: #0d1117;
  --s2: #161b22;
  --border: #1c2535;
  --green: #00ff87;
  --red: #ff3b5c;
  --yellow: #fbbf24;
  --text: #d4dbe8;
  --text2: #5a6478;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  padding: 24px;
}

.header {
  text-align: center;
  margin-bottom: 32px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.title {
  font-size: 28px;
  font-weight: 700;
  letter-spacing: 3px;
  margin-bottom: 8px;
}

.subtitle {
  font-size: 12px;
  color: var(--text2);
  letter-spacing: 1px;
}

.main-score {
  background: var(--s1);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 40px;
  text-align: center;
  margin-bottom: 32px;
}

.main-score.bullish {
  border-color: var(--green);
  background: linear-gradient(135deg, rgba(0, 255, 135, 0.05), rgba(0, 255, 135, 0.1));
}

.main-score.bearish {
  border-color: var(--red);
  background: linear-gradient(135deg, rgba(255, 59, 92, 0.05), rgba(255, 59, 92, 0.1));
}

.main-score.neutral {
  border-color: var(--yellow);
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), rgba(251, 191, 36, 0.1));
}

.score-number {
  font-size: 72px;
  font-weight: 700;
  margin: 16px 0;
}

.score-number.bullish { color: var(--green); }
.score-number.bearish { color: var(--red); }
.score-number.neutral { color: var(--yellow); }

.score-label {
  font-size: 24px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.indicators-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.indicator-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
}

.indicator-title {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text2);
  margin-bottom: 12px;
}

.indicator-value {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
}

.indicator-value.positive { color: var(--green); }
.indicator-value.negative { color: var(--red); }
.indicator-value.neutral { color: var(--text); }

.indicator-change {
  font-size: 11px;
  color: var(--text2);
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
}

.chart-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
}

.chart-title {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 16px;
  color: var(--text2);
}

.loading {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--border);
  border-top-color: var(--green);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  margin-bottom: 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.btn {
  background: var(--green);
  color: var(--bg);
  border: none;
  padding: 12px 24px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  border-radius: 6px;
  transition: opacity 0.2s;
  display: block;
  margin: 32px auto 0;
}

.btn:hover { opacity: 0.9; }
.btn:disabled { opacity: 0.3; cursor: not-allowed; }

@media (max-width: 1024px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class=&quot;header&quot;>
  <div class=&quot;title&quot;>ğŸ“Š DASHBOARD MACRO</div>
  <div class=&quot;subtitle&quot;>AnÃ¡lisis AutomÃ¡tico de Indicadores MacroeconÃ³micos</div>
</div>

<div id=&quot;content&quot;>
  <div class=&quot;loading&quot;>
    <div class=&quot;spinner&quot;></div>
    <div>Cargando indicadores macroeconÃ³micos...</div>
  </div>
</div>

<script>
// Datos reales del sistema macro (actualizado 14 Feb 2026)
const MACRO_DATA = {
  // Score total y zona
  totalScore: 3,
  maxScore: 17,
  zone: 'amarillo', // Soft Landing
  zoneLabel: 'ğŸŸ¡ SOFT LANDING',
  
  // SubcategorÃ­as
  adelantados: { score: 2, max: 3 },
  monetarios: { score: 1, max: 14 },
  
  // Indicadores Adelantados (3)
  leading: {
    curvaUSD: { 
      value: 0.64, 
      label: 'Curva USD (10Y-2Y)',
      unit: '%',
      signal: 'positive',
      desc: 'Positiva = +1'
    },
    curvaEUR: { 
      value: 0.80, 
      label: 'Curva EUR (10Y-2Y)',
      unit: '%',
      signal: 'positive',
      desc: 'Positiva = +1'
    },
    lei: { 
      value: -1.2, 
      label: 'LEI (6m anualizado)',
      unit: '%',
      signal: 'neutral',
      desc: 'Zona amarilla, lejos de -4.3%'
    }
  },
  
  // Indicadores Monetarios (8, ponderados)
  monetary: {
    m2Global: { 
      value: 5.2, 
      label: 'M2 Global',
      unit: '% YoY',
      weight: 3,
      score: 3,
      signal: 'positive',
      desc: 'Peso Ã—3 = +3 puntos'
    },
    credito: { 
      value: 2.0, 
      label: 'CrÃ©dito vs Nominal',
      unit: '%',
      weight: 3,
      score: 0,
      signal: 'neutral',
      desc: 'Peso Ã—3 = 0 puntos'
    },
    impulso: { 
      value: 1.0, 
      label: 'Impulso Crediticio',
      unit: '',
      weight: 2,
      score: 2,
      signal: 'positive',
      desc: 'Peso Ã—2 = +2 puntos'
    },
    velocidad: { 
      value: -1.8, 
      label: 'Velocidad M2',
      unit: '%',
      weight: 2,
      score: -2,
      signal: 'negative',
      desc: 'Peso Ã—2 = -2 puntos'
    },
    reservas: { 
      value: 2.93, 
      label: 'Reservas Bancarias',
      unit: 'T',
      weight: 1,
      score: -1,
      signal: 'negative',
      desc: '-10.4% YoY = -1 punto'
    },
    tipoReal: { 
      value: 1.23, 
      label: 'Tipo InterÃ©s Real',
      unit: '%',
      weight: 1,
      score: -1,
      signal: 'negative',
      desc: 'PolÃ­tica restrictiva = -1'
    },
    spreads: { 
      value: 0.96, 
      label: 'Corporate Spreads BBB',
      unit: '%',
      weight: 1,
      score: 1,
      signal: 'positive',
      desc: 'MÃ­nimos histÃ³ricos = +1'
    },
    putCall: { 
      value: 0.60, 
      label: 'Put/Call Ratio',
      unit: '',
      weight: 1,
      score: -1,
      signal: 'negative',
      desc: 'âš ï¸ Euforia = -1'
    }
  },
  
  // Escala de interpretaciÃ³n
  scale: [
    { min: 10, max: 17, zone: 'verde-oscuro', label: 'ğŸŸ¢ Boom / Euforia' },
    { min: 4, max: 10, zone: 'verde-claro', label: 'ğŸŸ¢ ExpansiÃ³n sÃ³lida' },
    { min: 0, max: 4, zone: 'amarillo', label: 'ğŸŸ¡ Soft Landing' },
    { min: -4, max: 0, zone: 'naranja', label: 'ğŸŸ  DesaceleraciÃ³n' },
    { min: -10, max: -4, zone: 'rojo-claro', label: 'ğŸ”´ RecesiÃ³n leve' },
    { min: -17, max: -10, zone: 'rojo-oscuro', label: 'ğŸ”´ RecesiÃ³n severa' }
  ],
  
  // Datos histÃ³ricos simulados (6 meses)
  history: {
    dates: ['Sep 25', 'Oct 25', 'Nov 25', 'Dec 25', 'Jan 26', 'Feb 26'],
    totalScore: [2, 2.5, 2.8, 3.2, 3.0, 3],
    curvaUSD: [0.45, 0.52, 0.58, 0.62, 0.65, 0.64],
    m2Global: [4.8, 4.9, 5.0, 5.1, 5.2, 5.2],
    lei: [-2.1, -1.8, -1.5, -1.3, -1.2, -1.2]
  }
};

function analyze() {
  const score = MACRO_DATA.totalScore;
  const maxScore = MACRO_DATA.maxScore;
  const zone = MACRO_DATA.zone;
  const zoneLabel = MACRO_DATA.zoneLabel;
  
  const signalClass = zone === 'amarillo' ? 'neutral' : 
                      zone.includes('verde') ? 'bullish' : 'bearish';
  
  const html = `
    <div class=&quot;main-score ${signalClass}&quot;>
      <div class=&quot;score-label&quot;>Score Total Macro</div>
      <div class=&quot;score-number ${signalClass}&quot;>${score > 0 ? '+' : ''}${score}/${maxScore}</div>
      <div class=&quot;score-label&quot;>${zoneLabel}</div>
      <div style=&quot;margin-top:16px;font-size:11px;opacity:0.8;&quot;>
        Adelantados: +${MACRO_DATA.adelantados.score}/${MACRO_DATA.adelantados.max} Â· 
        Monetarios: +${MACRO_DATA.monetarios.score}/${MACRO_DATA.monetarios.max}
      </div>
    </div>
    
    <div style=&quot;background:var(--s1);border:1px solid var(--border);border-radius:8px;padding:20px;margin-bottom:32px;&quot;>
      <div style=&quot;font-size:12px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-bottom:16px;color:var(--text2);&quot;>
        ğŸ“Š Escala de InterpretaciÃ³n
      </div>
      <div style=&quot;display:grid;gap:8px;&quot;>
        ${MACRO_DATA.scale.map(s => `
          <div style=&quot;padding:8px 12px;background:var(--s2);border-radius:4px;display:flex;justify-content:space-between;align-items:center;${s.zone === zone ? 'border-left:4px solid var(--green);' : ''}&quot;>
            <span style=&quot;font-size:11px;&quot;>${s.label}</span>
            <span style=&quot;font-size:11px;color:var(--text2);&quot;>${s.min > 0 ? '+' : ''}${s.min} a ${s.max > 0 ? '+' : ''}${s.max}</span>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div style=&quot;margin-bottom:32px;&quot;>
      <div style=&quot;font-size:14px;font-weight:600;letter-spacing:1px;margin-bottom:16px;&quot;>ğŸ”® INDICADORES ADELANTADOS</div>
      <div class=&quot;indicators-grid&quot;>
        ${Object.entries(MACRO_DATA.leading).map(([key, ind]) => `
          <div class=&quot;indicator-card&quot;>
            <div class=&quot;indicator-title&quot;>${ind.label}</div>
            <div class=&quot;indicator-value ${ind.signal}&quot;>${ind.value > 0 ? '+' : ''}${ind.value}${ind.unit}</div>
            <div class=&quot;indicator-change&quot;>${ind.desc}</div>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div style=&quot;margin-bottom:32px;&quot;>
      <div style=&quot;font-size:14px;font-weight:600;letter-spacing:1px;margin-bottom:16px;&quot;>ğŸ’° INDICADORES MONETARIOS (Ponderados)</div>
      <div class=&quot;indicators-grid&quot;>
        ${Object.entries(MACRO_DATA.monetary).map(([key, ind]) => `
          <div class=&quot;indicator-card&quot;>
            <div class=&quot;indicator-title&quot;>${ind.label} (Ã—${ind.weight})</div>
            <div class=&quot;indicator-value ${ind.signal}&quot;>${typeof ind.value === 'number' ? (ind.value > 0 &amp;&amp; !ind.unit.includes('T') ? '+' : '') + ind.value.toFixed(2) : ind.value}${ind.unit}</div>
            <div class=&quot;indicator-change&quot;>${ind.desc}</div>
          </div>
        `).join('')}
      </div>
    </div>
    
    <div class=&quot;charts-grid&quot;>
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>EvoluciÃ³n Score Total</div>
        <canvas id=&quot;scoreChart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>Curva USD (10Y-2Y)</div>
        <canvas id=&quot;curvaChart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>M2 Global (% YoY)</div>
        <canvas id=&quot;m2Chart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>LEI (% 6m anualizado)</div>
        <canvas id=&quot;leiChart&quot;></canvas>
      </div>
    </div>
    
    <button class=&quot;btn&quot; onclick=&quot;analyze()&quot;>âŸ² ACTUALIZAR VISTA</button>
  `;
  
  document.getElementById('content').innerHTML = html;
  
  // Crear grÃ¡ficos
  setTimeout(() => {
    const hist = MACRO_DATA.history;
    
    const chartOptions = {
      responsive: true,
      plugins: { legend: { labels: { color: '#d4dbe8' } } },
      scales: {
        y: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } },
        x: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } }
      }
    };
    
    // Score Total
    new Chart(document.getElementById('scoreChart'), {
      type: 'line',
      data: {
        labels: hist.dates,
        datasets: [{
          label: 'Score Total',
          data: hist.totalScore,
          borderColor: '#fbbf24',
          backgroundColor: 'rgba(251, 191, 36, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    // Curva USD
    new Chart(document.getElementById('curvaChart'), {
      type: 'line',
      data: {
        labels: hist.dates,
        datasets: [{
          label: 'Curva USD %',
          data: hist.curvaUSD,
          borderColor: '#00ff87',
          backgroundColor: 'rgba(0, 255, 135, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    // M2 Global
    new Chart(document.getElementById('m2Chart'), {
      type: 'line',
      data: {
        labels: hist.dates,
        datasets: [{
          label: 'M2 Global % YoY',
          data: hist.m2Global,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: chartOptions
    });
    
    // LEI
    new Chart(document.getElementById('leiChart'), {
      type: 'bar',
      data: {
        labels: hist.dates,
        datasets: [{
          label: 'LEI %',
          data: hist.lei,
          backgroundColor: hist.lei.map(v => v >= 0 ? '#00ff87' : '#ff3b5c')
        }]
      },
      options: chartOptions
    });
  }, 100);
}

// Auto-analizar al cargar
window.addEventListener('load', () => {
  setTimeout(analyze, 500);
});
</script>
</body>
</html>
"></iframe>
    <iframe class="module-frame"        id="frame-portfolio"  data-src="ethan_mercados.html"></iframe>
    <iframe class="module-frame"        id="frame-allocation" srcdoc="<!DOCTYPE html>
<html lang=&quot;es&quot;>
<head>
<meta charset=&quot;UTF-8&quot;>
<meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
<title>ETHAN Â· Asset Allocation</title>
<style>
:root {
  --bg: #06080c;
  --s1: #0d1117;
  --s2: #161b22;
  --border: #1c2535;
  --green: #00ff87;
  --red: #ff3b5c;
  --blue: #3b82f6;
  --yellow: #fbbf24;
  --text: #d4dbe8;
  --text2: #5a6478;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  padding: 32px;
}

.header {
  text-align: center;
  margin-bottom: 32px;
}

.title {
  font-size: 28px;
  font-weight: 700;
  letter-spacing: 3px;
  margin-bottom: 4px;
  color: var(--text2);
}

.subtitle {
  font-size: 11px;
  color: var(--text2);
  letter-spacing: 1px;
  margin-bottom: 32px;
}

/* DASHBOARD EJECUTIVO */
.executive-dashboard {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 32px;
}

.decision-card {
  background: var(--s1);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  text-align: center;
  transition: transform 0.2s, box-shadow 0.2s;
}

.decision-card:hover {
  transform: translateY(-2px);
}

.decision-card.green {
  border-color: var(--green);
  box-shadow: 0 0 30px rgba(0, 255, 135, 0.15);
}

.decision-card.red {
  border-color: var(--red);
  box-shadow: 0 0 30px rgba(255, 59, 92, 0.15);
}

.decision-card.yellow {
  border-color: var(--yellow);
  box-shadow: 0 0 30px rgba(251, 191, 36, 0.15);
}

.decision-card.blue {
  border-color: var(--blue);
  box-shadow: 0 0 30px rgba(59, 130, 246, 0.15);
}

.decision-icon {
  font-size: 48px;
  margin-bottom: 12px;
  line-height: 1;
}

.decision-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: var(--text2);
  margin-bottom: 8px;
}

.decision-value {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.decision-value.green { color: var(--green); }
.decision-value.red { color: var(--red); }
.decision-value.yellow { color: var(--yellow); }
.decision-value.blue { color: var(--blue); }

.decision-desc {
  font-size: 11px;
  color: var(--text2);
  line-height: 1.5;
}

@media (max-width: 1024px) {
  .executive-dashboard {
    grid-template-columns: 1fr;
  }
}

.recommendation {
  background: var(--s1);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 32px;
  text-align: center;
  margin-bottom: 40px;
}

.rec-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 2px;
  color: var(--text2);
  margin-bottom: 12px;
}

.rec-main {
  font-size: 48px;
  font-weight: 700;
  letter-spacing: 4px;
  margin-bottom: 16px;
}

.rec-main.rf { color: var(--blue); }
.rec-main.rv { color: var(--green); }
.rec-main.neutro { color: var(--yellow); }

.rec-desc {
  font-size: 13px;
  color: var(--text2);
  line-height: 1.6;
}

.section-title {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text2);
  margin: 32px 0 16px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

.warnings {
  display: grid;
  gap: 12px;
  margin-bottom: 32px;
}

.warning-item {
  background: var(--s1);
  border-left: 4px solid var(--border);
  padding: 16px 20px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.warning-item.alert {
  border-left-color: var(--red);
  background: rgba(255, 59, 92, 0.05);
}

.warning-item.caution {
  border-left-color: var(--yellow);
  background: rgba(251, 191, 36, 0.05);
}

.warning-item.ok {
  border-left-color: var(--green);
  background: rgba(0, 255, 135, 0.05);
}

.warning-icon {
  font-size: 24px;
}

.warning-text {
  flex: 1;
  font-size: 12px;
  line-height: 1.6;
}

.warning-text strong {
  color: var(--text);
  font-weight: 600;
}

.assets-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  margin-bottom: 24px;
}

.asset-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 24px;
  transition: border-color 0.3s;
}

.asset-card.selected {
  border: 2px solid var(--green);
  box-shadow: 0 0 20px rgba(0, 255, 135, 0.2);
}

.asset-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
}

.asset-ticker {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: 2px;
}

.asset-type {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 4px 10px;
  border-radius: 4px;
  background: var(--s2);
}

.asset-type.rf { color: var(--blue); }
.asset-type.rv { color: var(--green); }
.asset-type.gold { color: var(--yellow); }
.asset-type.hy { color: #f97316; }
.asset-type.fx { color: #8b5cf6; }

.asset-region {
  font-size: 11px;
  color: var(--text2);
  margin-top: 4px;
  text-align: center;
}

.score-display {
  text-align: center;
  margin-bottom: 20px;
}

.score-number {
  font-size: 48px;
  font-weight: 700;
}

.score-label {
  font-size: 10px;
  color: var(--text2);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-top: 4px;
}

.conditions {
  display: grid;
  gap: 8px;
}

.cond-group {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text2);
  margin-top: 12px;
  margin-bottom: 4px;
}

.cond {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: var(--s2);
  border-radius: 4px;
  font-size: 11px;
}

.cond-ok { color: var(--green); }
.cond-fail { color: var(--red); }

.btn {
  background: var(--green);
  color: var(--bg);
  border: none;
  padding: 12px 24px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  border-radius: 6px;
  transition: opacity 0.2s;
  display: block;
  margin: 0 auto;
}

.btn:hover { opacity: 0.9; }
.btn:disabled { opacity: 0.3; cursor: not-allowed; }

.loading {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--border);
  border-top-color: var(--green);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  margin-bottom: 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.methodology {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 24px;
  font-size: 12px;
  line-height: 1.8;
  color: var(--text2);
}

.methodology h3 {
  font-size: 14px;
  color: var(--text);
  margin-bottom: 12px;
  letter-spacing: 1px;
}

.methodology ul {
  list-style: none;
  padding-left: 0;
}

.methodology li {
  padding-left: 20px;
  position: relative;
  margin-bottom: 6px;
}

.methodology li:before {
  content: &quot;â†’&quot;;
  position: absolute;
  left: 0;
  color: var(--green);
}
</style>
</head>
<body>

<div class=&quot;header&quot;>
  <div class=&quot;title&quot;>ğŸ’¼ ASSET ALLOCATION</div>
  <div class=&quot;subtitle&quot;>RotaciÃ³n tÃ¡ctica RF/RV segÃºn fortaleza tÃ©cnica ETHAN</div>
</div>

<div id=&quot;content&quot;>
  <div class=&quot;loading&quot;>
    <div class=&quot;spinner&quot;></div>
    <div>Analizando ETFs...</div>
  </div>
</div>

<script>
// ETFs de Asset Allocation
const ASSETS = [
  // Renta Variable
  { ticker: 'VTI', name: 'Vanguard Total Stock Market', type: 'RV', region: 'ğŸ‡ºğŸ‡¸ USA', category: 'allocation' },
  { ticker: 'VEU', name: 'Vanguard FTSE All-World ex-US', type: 'RV', region: 'ğŸŒ Mundo', category: 'allocation' },
  
  // Renta Fija
  { ticker: 'IEF', name: 'iShares 7-10Y Treasury Bond', type: 'RF', region: 'ğŸ‡ºğŸ‡¸ USA', category: 'allocation' },
  { ticker: 'BNDX', name: 'Vanguard Total Intl Bond', type: 'RF', region: 'ğŸŒ Mundo', category: 'allocation' },
  
  // Indicadores adicionales
  { ticker: 'GLD', name: 'SPDR Gold Trust', type: 'GOLD', region: 'ğŸ¥‡ Oro', category: 'indicator' },
  { ticker: 'HYG', name: 'iShares iBoxx High Yield Corp Bond', type: 'HY', region: 'ğŸ’³ Corp', category: 'indicator' },
  { ticker: 'EURUSD=X', name: 'Euro/DÃ³lar', type: 'FX', region: 'ğŸ’± FX', category: 'indicator' }
];

// Indicadores
function sma(arr,p){return arr.map((_,i)=>{if(i<p-1)return null;const sl=arr.slice(i-p+1,i+1).filter(v=>v!=null&amp;&amp;!isNaN(v));return sl.length===p?sl.reduce((a,b)=>a+b,0)/p:null;});}
function ema(arr,p){const k=2/(p+1),out=new Array(arr.length).fill(null);let s=arr.findIndex(v=>v!=null&amp;&amp;!isNaN(v));if(s<0)return out;out[s]=arr[s];for(let i=s+1;i<arr.length;i++){const v=(arr[i]!=null&amp;&amp;!isNaN(arr[i]))?arr[i]:out[i-1];out[i]=v*k+out[i-1]*(1-k);}return out;}
function macd(closes){const ef=ema(closes,12),es=ema(closes,26);const m=ef.map((v,i)=>(v!=null&amp;&amp;es[i]!=null)?v-es[i]:null);const sl=ema(m.map(v=>v??0),9);return{m,sl};}
function rsi(closes,p=14){const out=new Array(closes.length).fill(null);if(closes.length<p+1)return out;let g=0,l=0;for(let i=1;i<=p;i++){const d=closes[i]-closes[i-1];d>0?g+=d:l-=d;}let ag=g/p,al=l/p;out[p]=al===0?100:100-(100/(1+ag/al));for(let i=p+1;i<closes.length;i++){const d=closes[i]-closes[i-1];ag=(ag*(p-1)+(d>0?d:0))/p;al=(al*(p-1)+(d<0?-d:0))/p;out[i]=al===0?100:100-(100/(1+ag/al));}return out;}
function stoch(highs,lows,closes,p){const rawK=closes.map((c,i)=>{if(i<p-1)return null;const hh=Math.max(...highs.slice(i-p+1,i+1));const ll=Math.min(...lows.slice(i-p+1,i+1));return hh===ll?50:(c-ll)/(hh-ll)*100;});const k=sma(rawK,3);const d=sma(k.map(v=>v??0),3);return{k,d};}
function resample(ts,opens,highs,lows,closes,vols,freq){const groups={};ts.forEach((t,i)=>{const dd=new Date(t*1000);let key;if(freq==='W'){const day=dd.getDay();const diff=dd.getDate()-day+(day===0?-6:1);const mo=new Date(+dd);mo.setDate(diff);key=mo.toISOString().slice(0,10);}else{key=`${dd.getFullYear()}-${String(dd.getMonth()+1).padStart(2,'0')}`;}if(!groups[key]){groups[key]={o:opens[i],h:highs[i],l:lows[i],c:closes[i],v:vols[i]};}else{groups[key].h=Math.max(groups[key].h,highs[i]);groups[key].l=Math.min(groups[key].l,lows[i]);groups[key].c=closes[i];groups[key].v+=vols[i];}});const keys=Object.keys(groups).sort();return{dates:keys,opens:keys.map(k=>groups[k].o),highs:keys.map(k=>groups[k].h),lows:keys.map(k=>groups[k].l),closes:keys.map(k=>groups[k].c),vols:keys.map(k=>groups[k].v)};}

async function fetchData(ticker){
  const yUrl=`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1d&amp;range=10y&amp;events=history`;
  const proxies=[
    u=>`https://corsproxy.io/?${encodeURIComponent(u)}`,
    u=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
    u=>`https://thingproxy.freeboard.io/fetch/${u}`,
  ];
  let lastErr;
  for(const fn of proxies){
    try{
      const r=await fetch(fn(yUrl),{signal:AbortSignal.timeout(12000)});
      if(!r.ok)throw new Error(`HTTP ${r.status}`);
      const j=JSON.parse(await r.text());
      if(j.chart?.error)throw new Error(j.chart.error.description);
      const res=j.chart.result[0];
      const q=res.indicators.quote[0];
      const adj=res.indicators.adjclose?.[0]?.adjclose||q.close;
      const ratio=adj.map((a,i)=>(q.close[i]&amp;&amp;a)?a/q.close[i]:1);
      return{
        timestamps:res.timestamp,
        opens:q.open.map((v,i)=>v*ratio[i]),
        highs:q.high.map((v,i)=>v*ratio[i]),
        lows:q.low.map((v,i)=>v*ratio[i]),
        closes:adj,
        vols:q.volume,
      };
    }catch(e){lastErr=e;}
  }
  throw lastErr||new Error('Sin conexiÃ³n');
}

function analyzeAsset(raw){
  const{timestamps,opens,highs,lows,closes,vols}=raw;
  const W=resample(timestamps,opens,highs,lows,closes,vols,'W');
  const M=resample(timestamps,opens,highs,lows,closes,vols,'M');
  
  // Mensual (sin Stoch8)
  const m_macd=macd(M.closes);
  const m_s89=stoch(M.highs,M.lows,M.closes,89);
  const m_rsi=rsi(M.closes,14);
  const m_sma10=sma(M.closes,10);
  const mi=M.closes.length-1;
  
  // Semanal
  const w_macd=macd(W.closes);
  const w_s89=stoch(W.highs,W.lows,W.closes,89);
  const w_rsi=rsi(W.closes,14);
  const w_sma20=sma(W.closes,20);
  const wi=W.closes.length-1;
  
  // Condiciones mensuales (4 condiciones, sin Stoch8)
  const mc={
    macd: m_macd.m[mi]>0 &amp;&amp; m_macd.m[mi]>m_macd.sl[mi],
    s89: (m_s89.k[mi]>80&amp;&amp;m_s89.k[mi]>m_s89.d[mi])||m_s89.k[mi]>92,
    rsi: m_rsi[mi]>65,
    precio: m_sma10[mi]&amp;&amp;M.closes[mi]>m_sma10[mi]
  };
  
  // Condiciones semanales (4 condiciones)
  const sc={
    macd: w_macd.m[wi]>0&amp;&amp;w_macd.m[wi]>w_macd.sl[wi],
    s89: (w_s89.k[wi]>85&amp;&amp;w_s89.k[wi]>w_s89.d[wi])||w_s89.k[wi]>92,
    rsi: w_rsi[wi]>67,
    precio: w_sma20[wi]&amp;&amp;W.closes[wi]>w_sma20[wi]
  };
  
  // Score total (8 condiciones)
  const score = Object.values(mc).filter(x=>x).length + Object.values(sc).filter(x=>x).length;
  
  return {
    score,
    mensual: mc,
    semanal: sc,
    price: closes[closes.length-1]
  };
}

async function runAnalysis(){
  const results = [];
  
  for(const asset of ASSETS){
    try{
      const raw = await fetchData(asset.ticker);
      const analysis = analyzeAsset(raw);
      results.push({
        ...asset,
        ...analysis
      });
    }catch(err){
      results.push({
        ...asset,
        score: 0,
        error: err.message
      });
    }
  }
  
  // Separar allocation vs indicators
  const allocationAssets = results.filter(a => a.category === 'allocation');
  const indicators = results.filter(a => a.category === 'indicator');
  
  // Ordenar allocation por score
  allocationAssets.sort((a,b) => b.score - a.score);
  
  // Los 2 mejores de allocation
  const top2 = allocationAssets.slice(0, 2);
  
  // Determinar recomendaciÃ³n
  const rfCount = top2.filter(a => a.type === 'RF').length;
  const rvCount = top2.filter(a => a.type === 'RV').length;
  
  let recommendation;
  let topRegion = '';
  
  if(rvCount === 2){
    recommendation = { type: 'RV', label: 'RENTA VARIABLE', desc: 'Los 2 ETFs mÃ¡s fuertes son de Renta Variable. PosiciÃ³n alcista recomendada.' };
    // Determinar regiÃ³n predominante
    const usaRV = top2.find(a => a.region.includes('USA'));
    const worldRV = top2.find(a => a.region.includes('Mundo'));
    if(usaRV &amp;&amp; !worldRV) topRegion = ' â†’ ğŸ‡ºğŸ‡¸ USA';
    else if(!usaRV &amp;&amp; worldRV) topRegion = ' â†’ ğŸŒ Resto Mundo';
    else topRegion = ' â†’ ğŸ‡ºğŸ‡¸ USA + ğŸŒ Mundo';
  }else if(rfCount === 2){
    recommendation = { type: 'RF', label: 'RENTA FIJA', desc: 'Los 2 ETFs mÃ¡s fuertes son de Renta Fija. PosiciÃ³n defensiva recomendada.' };
  }else{
    recommendation = { type: 'NEUTRO', label: 'MIXTO', desc: '1 RF + 1 RV entre los mÃ¡s fuertes. Considerar posiciÃ³n balanceada.' };
  }
  
  recommendation.label += topRegion;
  
  renderResults(allocationAssets, indicators, top2, recommendation);
}

function renderResults(allocationAssets, indicators, top2, rec){
  const recClass = rec.type.toLowerCase();
  
  // Encontrar indicadores
  const gold = indicators.find(i => i.type === 'GOLD');
  const hy = indicators.find(i => i.type === 'HY');
  const fx = indicators.find(i => i.type === 'FX');
  
  // DECISIONES EJECUTIVAS
  
  // 1. DecisiÃ³n de inversiÃ³n (RF vs RV)
  let investDecision = {
    icon: 'ğŸ“Š',
    label: 'DECISIÃ“N DE INVERSIÃ“N',
    value: rec.label,
    class: recClass,
    desc: rec.desc
  };
  
  if(rec.type === 'RV') {
    investDecision.icon = 'ğŸ“ˆ';
    investDecision.class = 'green';
  } else if(rec.type === 'RF') {
    investDecision.icon = 'ğŸ›¡ï¸';
    investDecision.class = 'blue';
  } else {
    investDecision.icon = 'âš–ï¸';
    investDecision.class = 'yellow';
  }
  
  // 2. Alerta de recesiÃ³n (basada en HY)
  let recessionAlert = {
    icon: 'ğŸ’³',
    label: 'RIESGO DE RECESIÃ“N',
    value: 'CARGANDO...',
    class: 'yellow',
    desc: 'Analizando bonos corporativos...'
  };
  
  if(hy &amp;&amp; !hy.error) {
    if(hy.score <= 3) {
      recessionAlert.value = 'âš ï¸ ALTO';
      recessionAlert.class = 'red';
      recessionAlert.desc = 'High Yield dÃ©bil. EstrÃ©s de crÃ©dito detectado. PrecauciÃ³n.';
    } else if(hy.score <= 5) {
      recessionAlert.value = 'âš¡ MODERADO';
      recessionAlert.class = 'yellow';
      recessionAlert.desc = 'High Yield neutral. Vigilar evoluciÃ³n del crÃ©dito corporativo.';
    } else {
      recessionAlert.value = 'âœ“ BAJO';
      recessionAlert.class = 'green';
      recessionAlert.desc = 'High Yield fuerte. CrÃ©dito corporativo saludable.';
    }
  }
  
  // 3. DecisiÃ³n de cobertura cambiaria (basada en EUR/USD)
  let hedgeDecision = {
    icon: 'ğŸ’±',
    label: 'COBERTURA CAMBIARIA',
    value: 'CARGANDO...',
    class: 'yellow',
    desc: 'Analizando EUR/USD...'
  };
  
  if(fx &amp;&amp; !fx.error) {
    if(fx.score >= 6) {
      hedgeDecision.value = 'SÃ CUBRIR';
      hedgeDecision.class = 'red';
      hedgeDecision.desc = 'Euro fuerte vs DÃ³lar. Considerar cobertura en posiciones USD.';
    } else if(fx.score >= 4) {
      hedgeDecision.value = 'VIGILAR';
      hedgeDecision.class = 'yellow';
      hedgeDecision.desc = 'EUR/USD neutral. Cobertura opcional segÃºn exposiciÃ³n.';
    } else {
      hedgeDecision.value = 'NO CUBRIR';
      hedgeDecision.class = 'green';
      hedgeDecision.desc = 'DÃ³lar fuerte. No es necesaria cobertura en posiciones USD.';
    }
  }
  
  // WARNINGS ADICIONALES
  const warnings = [];
  
  // Warning: Oro muy fuerte
  if(gold &amp;&amp; !gold.error &amp;&amp; gold.score >= 7) {
    warnings.push({
      type: 'caution',
      icon: 'ğŸ¥‡',
      text: '<strong>Oro en mÃ¡ximos:</strong> Mercado buscando refugio. Incertidumbre elevada. Validar posiciones de riesgo.'
    });
  }
  
  // Warning: Divergencia HY vs RV
  if(hy &amp;&amp; !hy.error &amp;&amp; rec.type === 'RV' &amp;&amp; hy.score <= 4) {
    warnings.push({
      type: 'alert',
      icon: 'âš ï¸',
      text: '<strong>Divergencia detectada:</strong> Renta Variable fuerte pero High Yield dÃ©bil. SeÃ±al contradictoria - extrema precauciÃ³n.'
    });
  }
  
  // Warning: Todo claro
  if(rec.type === 'RV' &amp;&amp; hy &amp;&amp; hy.score >= 6 &amp;&amp; gold &amp;&amp; gold.score <= 4) {
    warnings.push({
      type: 'ok',
      icon: 'âœ“',
      text: '<strong>Entorno favorable:</strong> RV fuerte, crÃ©dito sano, sin bÃºsqueda de refugio. Condiciones Ã³ptimas para posiciones alcistas.'
    });
  }
  
  // Warning: Modo defensivo total
  if(rec.type === 'RF' &amp;&amp; gold &amp;&amp; gold.score >= 6) {
    warnings.push({
      type: 'alert',
      icon: 'ğŸ›¡ï¸',
      text: '<strong>Modo defensivo total:</strong> RF + Oro fuertes. Mercado en mÃ¡xima aversiÃ³n al riesgo. Mantener postura conservadora.'
    });
  }
  
  const renderAssetCard = (a, isSelected = false) => `
    <div class=&quot;asset-card ${isSelected?'selected':''}&quot;>
      <div class=&quot;asset-header&quot;>
        <div class=&quot;asset-ticker&quot;>${a.ticker}</div>
        <div class=&quot;asset-type ${a.type.toLowerCase()}&quot;>${a.type}</div>
      </div>
      <div class=&quot;asset-region&quot;>${a.region}</div>
      
      <div class=&quot;score-display&quot;>
        <div class=&quot;score-number&quot; style=&quot;color:${a.score>=7?'var(--green)':a.score>=5?'var(--yellow)':'var(--text2)'}&quot;>${a.score}/8</div>
        <div class=&quot;score-label&quot;>Score ETHAN</div>
      </div>
      
      ${a.error ? `<div style=&quot;color:var(--red);text-align:center;font-size:11px;&quot;>Error: ${a.error}</div>` : `
        <div class=&quot;conditions&quot;>
          <div class=&quot;cond-group&quot;>ğŸ“… Mensual</div>
          <div class=&quot;cond&quot;>
            <span>MACDâ†‘</span>
            <span class=&quot;${a.mensual.macd?'cond-ok':'cond-fail'}&quot;>${a.mensual.macd?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>Stoch89>80</span>
            <span class=&quot;${a.mensual.s89?'cond-ok':'cond-fail'}&quot;>${a.mensual.s89?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>RSI>65</span>
            <span class=&quot;${a.mensual.rsi?'cond-ok':'cond-fail'}&quot;>${a.mensual.rsi?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>P>SMA10</span>
            <span class=&quot;${a.mensual.precio?'cond-ok':'cond-fail'}&quot;>${a.mensual.precio?'âœ“':'âœ—'}</span>
          </div>
          
          <div class=&quot;cond-group&quot;>ğŸ“Š Semanal</div>
          <div class=&quot;cond&quot;>
            <span>MACDâ†‘</span>
            <span class=&quot;${a.semanal.macd?'cond-ok':'cond-fail'}&quot;>${a.semanal.macd?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>Stoch89>85</span>
            <span class=&quot;${a.semanal.s89?'cond-ok':'cond-fail'}&quot;>${a.semanal.s89?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>RSI>67</span>
            <span class=&quot;${a.semanal.rsi?'cond-ok':'cond-fail'}&quot;>${a.semanal.rsi?'âœ“':'âœ—'}</span>
          </div>
          <div class=&quot;cond&quot;>
            <span>P>SMA20</span>
            <span class=&quot;${a.semanal.precio?'cond-ok':'cond-fail'}&quot;>${a.semanal.precio?'âœ“':'âœ—'}</span>
          </div>
        </div>
      `}
    </div>
  `;
  
  const html = `
    <div class=&quot;executive-dashboard&quot;>
      <div class=&quot;decision-card ${investDecision.class}&quot;>
        <div class=&quot;decision-icon&quot;>${investDecision.icon}</div>
        <div class=&quot;decision-label&quot;>${investDecision.label}</div>
        <div class=&quot;decision-value ${investDecision.class}&quot;>${investDecision.value}</div>
        <div class=&quot;decision-desc&quot;>${investDecision.desc}</div>
      </div>
      
      <div class=&quot;decision-card ${recessionAlert.class}&quot;>
        <div class=&quot;decision-icon&quot;>${recessionAlert.icon}</div>
        <div class=&quot;decision-label&quot;>${recessionAlert.label}</div>
        <div class=&quot;decision-value ${recessionAlert.class}&quot;>${recessionAlert.value}</div>
        <div class=&quot;decision-desc&quot;>${recessionAlert.desc}</div>
      </div>
      
      <div class=&quot;decision-card ${hedgeDecision.class}&quot;>
        <div class=&quot;decision-icon&quot;>${hedgeDecision.icon}</div>
        <div class=&quot;decision-label&quot;>${hedgeDecision.label}</div>
        <div class=&quot;decision-value ${hedgeDecision.class}&quot;>${hedgeDecision.value}</div>
        <div class=&quot;decision-desc&quot;>${hedgeDecision.desc}</div>
      </div>
    </div>
    
    ${warnings.length > 0 ? `
      <div class=&quot;warnings&quot;>
        ${warnings.map(w => `
          <div class=&quot;warning-item ${w.type}&quot;>
            <div class=&quot;warning-icon&quot;>${w.icon}</div>
            <div class=&quot;warning-text&quot;>${w.text}</div>
          </div>
        `).join('')}
      </div>
    ` : ''}
    
    <div class=&quot;section-title&quot;>ğŸ“Š Asset Allocation (RF vs RV)</div>
    <div class=&quot;assets-grid&quot;>
      ${allocationAssets.map(a => renderAssetCard(a, top2.includes(a))).join('')}
    </div>
    
    <div class=&quot;section-title&quot;>ğŸ”” Indicadores de Mercado</div>
    <div class=&quot;assets-grid&quot; style=&quot;grid-template-columns: repeat(3, 1fr);&quot;>
      ${gold ? renderAssetCard(gold) : ''}
      ${hy ? renderAssetCard(hy) : ''}
      ${fx ? renderAssetCard(fx) : ''}
    </div>
    
    <div class=&quot;methodology&quot;>
      <h3>InterpretaciÃ³n de Indicadores</h3>
      <ul>
        <li><strong>ğŸ¥‡ Oro (GLD):</strong> Score alto â†’ Busca refugio, incertidumbre. Score bajo â†’ Apetito por riesgo</li>
        <li><strong>ğŸ’³ High Yield (HYG):</strong> Score bajo â†’ EstrÃ©s de crÃ©dito, posible recesiÃ³n. Score alto â†’ CrÃ©dito saludable</li>
        <li><strong>ğŸ’± EUR/USD:</strong> Score alto (euro fuerte) â†’ Considerar cobertura si inviertes en USD. Score bajo â†’ Sin necesidad de cobertura</li>
      </ul>
      
      <h3 style=&quot;margin-top:20px;&quot;>MetodologÃ­a Allocation</h3>
      <ul>
        <li>Sistema ETHAN aplicado a 4 ETFs (2 RF + 2 RV)</li>
        <li>Condiciones: Mensual (4) + Semanal (4) = 8 puntos mÃ¡ximo</li>
        <li>Se seleccionan los 2 ETFs con mayor score</li>
        <li>Si top 2 = RF â†’ PosiciÃ³n defensiva</li>
        <li>Si top 2 = RV â†’ PosiciÃ³n alcista (especifica regiÃ³n predominante)</li>
        <li>Si top 2 = 1 RF + 1 RV â†’ PosiciÃ³n mixta</li>
      </ul>
    </div>
    
    <button class=&quot;btn&quot; onclick=&quot;runAnalysis()&quot; style=&quot;margin-top:24px;&quot;>âŸ² ACTUALIZAR ANÃLISIS</button>
  `;
  
  document.getElementById('content').innerHTML = html;
}

// Auto-ejecutar al cargar
window.addEventListener('load', () => {
  setTimeout(runAnalysis, 500);
});
</script>
</body>
</html>
"></iframe>

    <iframe class="module-frame"        id="frame-fundamental" srcdoc="<!DOCTYPE html>
<html lang=&quot;es&quot;>
<head>
<meta charset=&quot;UTF-8&quot;>
<meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;>
<title>AnÃ¡lisis Fundamental AutomÃ¡tico</title>
<script src=&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;></script>
<style>
:root {
  --bg: #06080c;
  --s1: #0d1117;
  --s2: #161b22;
  --border: #1c2535;
  --green: #00ff87;
  --red: #ff3b5c;
  --blue: #3b82f6;
  --text: #d4dbe8;
  --text2: #5a6478;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 13px;
  padding: 24px;
}

.header {
  display: flex;
  gap: 12px;
  margin-bottom: 32px;
  align-items: center;
}

#tickerInput {
  flex: 1;
  background: var(--s1);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px 16px;
  font-family: inherit;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.btn {
  background: var(--green);
  color: var(--bg);
  border: none;
  padding: 12px 24px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  cursor: pointer;
  transition: opacity 0.2s;
}

.btn:hover { opacity: 0.9; }
.btn:disabled { opacity: 0.3; cursor: not-allowed; }

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 32px;
}

.metric-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
}

.metric-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text2);
  margin-bottom: 8px;
}

.metric-value {
  font-size: 24px;
  font-weight: 700;
}

.metric-value.positive { color: var(--green); }
.metric-value.negative { color: var(--red); }
.metric-value.neutral { color: var(--text); }

.charts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  margin-bottom: 32px;
}

.chart-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
}

.chart-title {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 16px;
  color: var(--text2);
}

.loading {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--border);
  border-top-color: var(--green);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  margin-bottom: 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.error {
  background: rgba(255, 59, 92, 0.1);
  border: 1px solid var(--red);
  border-radius: 8px;
  padding: 20px;
  text-align: center;
  color: var(--red);
}

@media (max-width: 1024px) {
  .charts-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<div class=&quot;header&quot;>
  <input type=&quot;text&quot; id=&quot;tickerInput&quot; placeholder=&quot;Introduce ticker (ej: AAPL, MSFT, GOOGL)&quot; value=&quot;AAPL&quot;>
  <button class=&quot;btn&quot; onclick=&quot;analyze()&quot; id=&quot;analyzeBtn&quot;>ANALIZAR</button>
</div>

<div id=&quot;content&quot;>
  <div class=&quot;loading&quot;>
    <div>Introduce un ticker y haz clic en ANALIZAR</div>
  </div>
</div>

<script>
let charts = {};

async function fetchFundamentals(ticker) {
  // Una sola peticiÃ³n con todos los mÃ³dulos necesarios
  const url = `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${ticker}?modules=defaultKeyStatistics,financialData,summaryDetail,incomeStatementHistory,balanceSheetHistory,cashflowStatementHistory`;
  
  const proxies = [
    u => u, // Directo
    u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
    u => `https://corsproxy.io/?${encodeURIComponent(u)}`,
  ];
  
  for (const proxy of proxies) {
    try {
      const proxyUrl = proxy(url);
      console.log(`Intentando: ${proxyUrl.substring(0, 100)}...`);
      
      const r = await fetch(proxyUrl, {
        signal: AbortSignal.timeout(20000),
        headers: {
          'Accept': 'application/json',
          'User-Agent': 'Mozilla/5.0'
        }
      });
      
      if (!r.ok) {
        console.warn(`HTTP ${r.status}`);
        continue;
      }
      
      const text = await r.text();
      const data = JSON.parse(text);
      
      if (data.quoteSummary?.result?.[0]) {
        console.log('âœ“ Datos obtenidos correctamente');
        return data.quoteSummary.result[0];
      } else if (data.quoteSummary?.error) {
        throw new Error(data.quoteSummary.error.description);
      }
    } catch(e) {
      console.warn(`Error con proxy:`, e.message);
      continue;
    }
  }
  
  throw new Error('No se pudo conectar con Yahoo Finance. Los proxies pueden estar bloqueados o el ticker no existe.');
}

function extractValue(obj) {
  return obj?.raw ?? obj?.fmt ?? obj ?? 'N/A';
}

function createChart(canvasId, config) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return null;
  
  // Destruir grÃ¡fico anterior si existe
  if (charts[canvasId]) {
    charts[canvasId].destroy();
  }
  
  charts[canvasId] = new Chart(canvas, config);
  return charts[canvasId];
}

async function analyze() {
  const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
  if (!ticker) return;
  
  const btn = document.getElementById('analyzeBtn');
  btn.disabled = true;
  
  document.getElementById('content').innerHTML = `
    <div class=&quot;loading&quot;>
      <div class=&quot;spinner&quot;></div>
      <div>Analizando ${ticker}...</div>
    </div>
  `;
  
  try {
    const data = await fetchFundamentals(ticker);
    
    if (!data) {
      throw new Error('No se encontraron datos para este ticker');
    }
    
    renderAnalysis(ticker, data);
  } catch(err) {
    document.getElementById('content').innerHTML = `
      <div class=&quot;error&quot;>
        <strong>Error:</strong> ${err.message}
      </div>
    `;
  } finally {
    btn.disabled = false;
  }
}

function renderAnalysis(ticker, allData) {
  const stats = allData?.defaultKeyStatistics || {};
  const fin = allData?.financialData || {};
  const detail = allData?.summaryDetail || {};
  
  // Extraer mÃ©tricas
  const metrics = {
    price: extractValue(detail.previousClose || detail.regularMarketPrice),
    marketCap: extractValue(detail.marketCap),
    per: extractValue(stats.trailingPE),
    peg: extractValue(stats.pegRatio),
    priceToBook: extractValue(stats.priceToBook),
    roe: extractValue(fin.returnOnEquity),
    roa: extractValue(fin.returnOnAssets),
    debtToEquity: extractValue(fin.debtToEquity),
    currentRatio: extractValue(fin.currentRatio),
    profitMargin: extractValue(fin.profitMargins),
    revenueGrowth: extractValue(fin.revenueGrowth),
    earningsGrowth: extractValue(fin.earningsGrowth)
  };
  
  // Formatear valores
  const fmt = (v, suffix = '') => {
    if (v === 'N/A' || v === null || v === undefined || isNaN(v)) return 'N/A';
    if (typeof v === 'string') return v;
    return v.toFixed(2) + suffix;
  };
  
  const fmtBillions = (v) => {
    if (v === 'N/A' || v === null || v === undefined || isNaN(v)) return 'N/A';
    if (v >= 1e12) return '$' + (v / 1e12).toFixed(2) + 'T';
    if (v >= 1e9) return '$' + (v / 1e9).toFixed(2) + 'B';
    if (v >= 1e6) return '$' + (v / 1e6).toFixed(2) + 'M';
    return '$' + v.toFixed(2);
  };
  
  const fmtPct = (v) => {
    if (v === 'N/A' || v === null || v === undefined || isNaN(v)) return 'N/A';
    if (typeof v === 'string') return v;
    return (v * 100).toFixed(2) + '%';
  };
  
  const getClass = (v, threshold, inverse = false) => {
    if (v === 'N/A' || v === null || v === undefined || isNaN(v)) return 'neutral';
    const isGood = inverse ? v < threshold : v > threshold;
    return isGood ? 'positive' : v === threshold ? 'neutral' : 'negative';
  };
  
  // HistÃ³ricos (si existen)
  const incomeHistory = allData?.incomeStatementHistory?.incomeStatementHistory || [];
  const balanceHistory = allData?.balanceSheetHistory?.balanceSheetStatements || [];
  const cashflowHistory = allData?.cashflowStatementHistory?.cashflowStatements || [];
  
  const hasHistoricalData = incomeHistory.length > 0 || balanceHistory.length > 0 || cashflowHistory.length > 0;
  
  const years = incomeHistory.map(i => {
    try {
      return new Date(i.endDate.fmt).getFullYear();
    } catch(e) {
      return 'N/A';
    }
  }).filter(y => y !== 'N/A').reverse();
  
  const revenues = incomeHistory.map(i => {
    const val = extractValue(i.totalRevenue);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? val / 1e9 : 0;
  }).reverse();
  
  const netIncome = incomeHistory.map(i => {
    const val = extractValue(i.netIncome);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? val / 1e9 : 0;
  }).reverse();
  
  const assets = balanceHistory.map(b => {
    const val = extractValue(b.totalAssets);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? val / 1e9 : 0;
  }).reverse();
  
  const liabilities = balanceHistory.map(b => {
    const val = extractValue(b.totalLiab);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? val / 1e9 : 0;
  }).reverse();
  
  const operatingCashflow = cashflowHistory.map(c => {
    const val = extractValue(c.totalCashFromOperatingActivities);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? val / 1e9 : 0;
  }).reverse();
  
  const capex = cashflowHistory.map(c => {
    const val = extractValue(c.capitalExpenditures || 0);
    return val !== 'N/A' &amp;&amp; !isNaN(val) ? Math.abs(val) / 1e9 : 0;
  }).reverse();
  
  const fcf = operatingCashflow.map((ocf, i) => ocf - (capex[i] || 0));
  
  const html = `
    <div class=&quot;metrics-grid&quot;>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ’° Precio</div>
        <div class=&quot;metric-value neutral&quot;>$${fmt(metrics.price)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ“Š Market Cap</div>
        <div class=&quot;metric-value neutral&quot;>${fmtBillions(metrics.marketCap)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ“ˆ PER</div>
        <div class=&quot;metric-value ${getClass(metrics.per, 25, true)}&quot;>${fmt(metrics.per)}x</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ“‰ PEG</div>
        <div class=&quot;metric-value ${getClass(metrics.peg, 2, true)}&quot;>${fmt(metrics.peg)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ† ROE</div>
        <div class=&quot;metric-value ${getClass(metrics.roe, 0.15)}&quot;>${fmtPct(metrics.roe)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ’¼ ROA</div>
        <div class=&quot;metric-value ${getClass(metrics.roa, 0.05)}&quot;>${fmtPct(metrics.roa)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ“Š Deuda/Equity</div>
        <div class=&quot;metric-value ${getClass(metrics.debtToEquity, 100, true)}&quot;>${fmt(metrics.debtToEquity)}%</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ’§ Current Ratio</div>
        <div class=&quot;metric-value ${getClass(metrics.currentRatio, 1)}&quot;>${fmt(metrics.currentRatio)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ’¹ Profit Margin</div>
        <div class=&quot;metric-value ${getClass(metrics.profitMargin, 0.10)}&quot;>${fmtPct(metrics.profitMargin)}</div>
      </div>
      <div class=&quot;metric-card&quot;>
        <div class=&quot;metric-label&quot;>ğŸ“ˆ Revenue Growth</div>
        <div class=&quot;metric-value ${getClass(metrics.revenueGrowth, 0)}&quot;>${fmtPct(metrics.revenueGrowth)}</div>
      </div>
    </div>
    
    ${hasHistoricalData ? `
    <div class=&quot;charts-grid&quot;>
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>Ingresos vs Beneficio Neto ($ Billions)</div>
        <canvas id=&quot;revenueChart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>Activos vs Pasivos ($ Billions)</div>
        <canvas id=&quot;balanceChart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>Free Cash Flow ($ Billions)</div>
        <canvas id=&quot;fcfChart&quot;></canvas>
      </div>
      
      <div class=&quot;chart-card&quot;>
        <div class=&quot;chart-title&quot;>MÃ¡rgenes y Rentabilidad</div>
        <canvas id=&quot;marginsChart&quot;></canvas>
      </div>
    </div>
    ` : '<div style=&quot;text-align:center;color:var(--text2);padding:40px;&quot;>No hay datos histÃ³ricos disponibles para este ticker</div>'}
  `;
  
  document.getElementById('content').innerHTML = html;
  
  // Crear grÃ¡ficos solo si hay datos histÃ³ricos
  if (!hasHistoricalData) return;
  
  setTimeout(() => {
    // Revenue Chart
    createChart('revenueChart', {
      type: 'line',
      data: {
        labels: years,
        datasets: [{
          label: 'Ingresos',
          data: revenues,
          borderColor: '#00ff87',
          backgroundColor: 'rgba(0, 255, 135, 0.1)',
          tension: 0.4
        }, {
          label: 'Beneficio Neto',
          data: netIncome,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#d4dbe8' } } },
        scales: {
          y: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } },
          x: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } }
        }
      }
    });
    
    // Balance Chart
    createChart('balanceChart', {
      type: 'bar',
      data: {
        labels: years,
        datasets: [{
          label: 'Activos',
          data: assets,
          backgroundColor: '#00ff87'
        }, {
          label: 'Pasivos',
          data: liabilities,
          backgroundColor: '#ff3b5c'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#d4dbe8' } } },
        scales: {
          y: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } },
          x: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } }
        }
      }
    });
    
    // FCF Chart
    createChart('fcfChart', {
      type: 'line',
      data: {
        labels: years,
        datasets: [{
          label: 'Operating Cashflow',
          data: operatingCashflow,
          borderColor: '#00ff87',
          fill: false
        }, {
          label: 'CapEx',
          data: capex.map(v => -v),
          borderColor: '#ff3b5c',
          fill: false
        }, {
          label: 'Free Cash Flow',
          data: fcf,
          borderColor: '#fbbf24',
          backgroundColor: 'rgba(251, 191, 36, 0.1)',
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#d4dbe8' } } },
        scales: {
          y: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } },
          x: { ticks: { color: '#5a6478' }, grid: { color: '#1c2535' } }
        }
      }
    });
    
    // Margins Chart
    createChart('marginsChart', {
      type: 'radar',
      data: {
        labels: ['ROE', 'ROA', 'Profit Margin', 'Revenue Growth', 'Earnings Growth'],
        datasets: [{
          label: ticker,
          data: [
            (metrics.roe || 0) * 100,
            (metrics.roa || 0) * 100,
            (metrics.profitMargin || 0) * 100,
            (metrics.revenueGrowth || 0) * 100,
            (metrics.earningsGrowth || 0) * 100
          ],
          backgroundColor: 'rgba(0, 255, 135, 0.2)',
          borderColor: '#00ff87',
          pointBackgroundColor: '#00ff87'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#d4dbe8' } } },
        scales: {
          r: {
            ticks: { color: '#5a6478', backdropColor: 'transparent' },
            grid: { color: '#1c2535' },
            pointLabels: { color: '#d4dbe8' }
          }
        }
      }
    });
  }, 100);
}

// Auto-analizar al cargar
window.addEventListener('load', () => {
  setTimeout(() => analyze(), 500);
});

// Enter para analizar
document.getElementById('tickerInput').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') analyze();
});
</script>
</body>
</html>
"></iframe>
    <iframe class="module-frame"        id="frame-sectors"     data-src="sectors.html"></iframe>
  </div>

  <div class="status-bar">
    <span><span class="status-dot"></span>&nbsp; ONLINE</span>
    <span id="status-module">ANÃLISIS MACRO</span>
    <span style="margin-left:auto;">ethan mercados Â· plataforma v2.0</span>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// ContraseÃ±a por defecto: ethan2026
const PASS_HASH = 'e1e8769e31fe6dc1fc7f38303b86e94eefe30856354710cefb1471daa17c8ba7';

async function sha256(text) {
  const d = new TextEncoder().encode(text);
  const h = await crypto.subtle.digest('SHA-256', d);
  return Array.from(new Uint8Array(h)).map(b => b.toString(16).padStart(2,'0')).join('');
}

const SK = 'ethan_session', SD = 86400000;
function checkSession() {
  try { const {hash,time} = JSON.parse(localStorage.getItem(SK)); return hash===PASS_HASH && Date.now()-time<SD; } catch(e){return false;}
}
function saveSession() { localStorage.setItem(SK, JSON.stringify({hash:PASS_HASH, time:Date.now()})); }

async function doLogin() {
  const pass = document.getElementById('login-pass').value;
  const hash = await sha256(pass);
  if (hash === PASS_HASH) { saveSession(); showApp(); }
  else {
    document.getElementById('login-error').textContent = 'ContraseÃ±a incorrecta';
    document.getElementById('login-pass').value = '';
    document.getElementById('login-pass').focus();
    setTimeout(() => document.getElementById('login-error').textContent = '', 3000);
  }
}

function doLogout() { localStorage.removeItem(SK); location.reload(); }

function showApp() {
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('app').classList.add('active');
  setTimeout(() => document.getElementById('login-screen').style.display='none', 700);
}

if (checkSession()) showApp();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TABS = ['macro','allocation','sectors','sp500','screener','portfolio','fundamental'];
const LABELS = {macro:'ANÃLISIS MACRO',allocation:'ASSET ALLOCATION',sectors:'SECTORES USA',sp500:'SCREENER S&P 500',screener:'SCREENER',portfolio:'CARTERA',fundamental:'ANÃLISIS FUNDAMENTAL'};
const loaded = new Set(['screener']);

function switchTab(id) {
  TABS.forEach(t => {
    document.getElementById('frame-'+t).classList.remove('active');
    document.getElementById('tab-'+t).classList.remove('active');
  });
  const fr = document.getElementById('frame-'+id);
  if (!loaded.has(id)) {
    const src = fr.getAttribute('data-src');
    if (src) { document.getElementById('loader').classList.remove('hidden'); fr.src=src; fr.removeAttribute('data-src'); loaded.add(id); }
  }
  fr.classList.add('active');
  document.getElementById('tab-'+id).classList.add('active');
  document.getElementById('status-module').textContent = LABELS[id]||id.toUpperCase();
}

document.querySelectorAll('.module-frame').forEach(f => f.addEventListener('load', () => document.getElementById('loader').classList.add('hidden')));

/* Clock + shortcuts */
const ck = () => { const e=document.getElementById('clock'); if(e) e.textContent=new Date().toLocaleString('es-ES'); };
setInterval(ck,1000); ck();
document.addEventListener('keydown', e => {
  if (document.getElementById('login-screen').style.display!=='none') return;
  if (e.altKey && e.key>='1' && e.key<='6') { e.preventDefault(); switchTab(TABS[+e.key-1]); }
});
</script>
</body>
</html>
