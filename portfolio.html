<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Analytics - RV Alcista & Bajista</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #0a0e27;
            --bg-card: #141b2d;
            --bg-secondary: #1a2332;
            --accent-bull: #00d4aa;
            --accent-bear: #ff6b9d;
            --accent-neutral: #4c9aff;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border: #1e293b;
            --success: #00d4aa;
            --danger: #ff6b9d;
            --warning: #fbbf24;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #141b2d 0%, #1a2332 100%);
            padding: 50px 40px;
            margin-bottom: 30px;
            border-radius: 20px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(0, 212, 170, 0.05), transparent 50%),
                        radial-gradient(circle at 70% 50%, rgba(255, 107, 157, 0.05), transparent 50%);
        }

        header .content {
            position: relative;
            z-index: 1;
        }

        h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-bull) 0%, var(--accent-bear) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.1em;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Strategy Switcher */
        .strategy-switcher {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .strategy-btn {
            flex: 1;
            padding: 18px 30px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1em;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }

        .strategy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .strategy-btn:hover::before {
            opacity: 1;
        }

        .strategy-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .strategy-btn.active {
            color: var(--bg-dark);
            border-color: transparent;
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .strategy-btn.bull.active {
            background: linear-gradient(135deg, var(--accent-bull) 0%, #00b894 100%);
        }

        .strategy-btn.bear.active {
            background: linear-gradient(135deg, var(--accent-bear) 0%, #ff4757 100%);
        }

        .strategy-btn.general.active {
            background: linear-gradient(135deg, var(--accent-neutral) 0%, #667eea 100%);
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .metric-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            transition: transform 0.3s ease;
            transform: scaleX(0);
            transform-origin: left;
        }

        .metric-card.bull::after {
            background: linear-gradient(90deg, var(--accent-bull), #00b894);
        }

        .metric-card.bear::after {
            background: linear-gradient(90deg, var(--accent-bear), #ff4757);
        }

        .metric-card.neutral::after {
            background: linear-gradient(90deg, var(--accent-neutral), #667eea);
        }

        .metric-card:hover::after {
            transform: scaleX(1);
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-neutral);
        }

        .metric-icon {
            font-size: 2em;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .metric-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .metric-value {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
        }

        .metric-change {
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }
        .neutral { color: var(--accent-neutral); }

        /* Section */
        .section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Comparison Cards */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .comparison-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .comparison-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 15px 15px 0 0;
        }

        .comparison-card.bull::before {
            background: var(--accent-bull);
        }

        .comparison-card.bear::before {
            background: var(--accent-bear);
        }

        .comparison-title {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comparison-metrics {
            display: grid;
            gap: 15px;
        }

        .comparison-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .comparison-item:last-child {
            border-bottom: none;
        }

        .comparison-item label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .comparison-item .value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.1em;
        }

        /* Charts */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
        }

        .chart-container {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-secondary);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75em;
            letter-spacing: 1.2px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg-secondary);
        }

        .ticker {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85em;
            font-family: 'JetBrains Mono', monospace;
        }

        .ticker.bull {
            background: rgba(0, 212, 170, 0.15);
            color: var(--accent-bull);
            border: 1px solid var(--accent-bull);
        }

        .ticker.bear {
            background: rgba(255, 107, 157, 0.15);
            color: var(--accent-bear);
            border: 1px solid var(--accent-bear);
        }

        /* Strategy Views */
        .strategy-view {
            display: none;
        }

        .strategy-view.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Export Button */
        .export-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-neutral) 0%, #667eea 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 154, 255, 0.4);
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-input {
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent-neutral);
            box-shadow: 0 0 0 3px rgba(76, 154, 255, 0.1);
        }

        /* Ratios Grid */
        .ratios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .ratio-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 22px 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .ratio-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .ratio-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
        }

        .ratio-card.bull::before { background: var(--accent-bull); }
        .ratio-card.bear::before { background: var(--accent-bear); }
        .ratio-card.neutral::before { background: var(--accent-neutral); }

        .ratio-top {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .ratio-icon {
            font-size: 1.8em;
            line-height: 1;
        }

        .ratio-badge {
            font-size: 0.75em;
            font-family: 'JetBrains Mono', monospace;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
        }

        .ratio-badge.up {
            background: rgba(0, 212, 170, 0.15);
            color: var(--accent-bull);
        }

        .ratio-badge.down {
            background: rgba(255, 107, 157, 0.15);
            color: var(--accent-bear);
        }

        .ratio-badge.flat {
            background: rgba(76, 154, 255, 0.15);
            color: var(--accent-neutral);
        }

        .ratio-label {
            font-size: 0.82em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ratio-value {
            font-size: 2.2em;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
            margin-bottom: 8px;
        }

        .ratio-desc {
            font-size: 0.85em;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .ratio-sub {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            font-size: 0.82em;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        /* Projection Card */
        .projection-card {
            background: linear-gradient(135deg, rgba(0,212,170,0.05) 0%, rgba(76,154,255,0.05) 100%);
            border: 1px solid rgba(0,212,170,0.2);
            border-radius: 16px;
            padding: 30px;
        }

        .projection-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .projection-icon {
            font-size: 2.5em;
        }

        .projection-header h3 {
            font-size: 1.3em;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .projection-header p {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .projection-bars {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 20px;
            height: 180px;
            margin-bottom: 25px;
            padding: 0 20px;
        }

        .proj-year {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            height: 100%;
            justify-content: flex-end;
            gap: 8px;
        }

        .proj-bar {
            width: 100%;
            height: calc(var(--h));
            border-radius: 8px 8px 0 0;
            transition: opacity 0.3s;
            min-height: 30px;
        }

        .bull-bar { background: linear-gradient(180deg, rgba(0,212,170,0.8) 0%, rgba(0,184,148,0.4) 100%); }
        .highlight-bar { background: linear-gradient(180deg, var(--accent-bull) 0%, rgba(0,184,148,0.7) 100%) !important; box-shadow: 0 0 20px rgba(0,212,170,0.4); }

        .proj-label {
            font-size: 0.8em;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .proj-val {
            font-size: 0.85em;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-bull);
        }

        .final-val {
            font-size: 1em;
            color: var(--accent-bull);
        }

        .projection-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .proj-stat {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .proj-stat-label {
            font-size: 0.8em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'JetBrains Mono', monospace;
        }

        .proj-stat-value {
            font-size: 1.4em;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .dashboard { grid-template-columns: 1fr; }
            .chart-grid { grid-template-columns: 1fr; }
            .strategy-switcher { flex-direction: column; }
            .comparison-grid { grid-template-columns: 1fr; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-neutral);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="content">
                <h1>üìä PORTFOLIO ANALYTICS</h1>
                <p class="subtitle">Renta Variable: Estrategias Alcista & Bajista</p>
            </div>
        </header>

        <!-- Strategy Switcher -->
        <div class="strategy-switcher">
            <button class="strategy-btn bull active" onclick="switchStrategy('bull')">
                üêÇ RV ALCISTA
            </button>
            <button class="strategy-btn bear" onclick="switchStrategy('bear')">
                üêª RV BAJISTA
            </button>
            <button class="strategy-btn general" onclick="switchStrategy('general')">
                ‚ö° GENERAL
            </button>
        </div>

        <!-- BULL VIEW -->
        <div class="strategy-view active" id="bull-view">
            <div class="dashboard" id="bullDashboard"></div>

            <!-- RATIOS SECTION -->
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üßÆ An√°lisis de Ratios ‚Äî RV Alcista</h2>
                </div>

                <div class="ratios-grid" id="bullRatios"></div>

                <!-- Proyecci√≥n 5 a√±os -->
                <div class="projection-card">
                    <div class="projection-header">
                        <span class="projection-icon">üöÄ</span>
                        <div>
                            <h3>Proyecci√≥n a 5 a√±os con ‚Ç¨100.000</h3>
                            <p>Reinvirtiendo la ganancia media por operaci√≥n (4.01%) cada 33.7 d√≠as ¬∑ ~10.8 ops/a√±o ¬∑ 54 ops en 5 a√±os</p>
                        </div>
                    </div>
                    <div class="projection-bars">
                        <div class="proj-year" style="--h:18%">
                            <div class="proj-bar bull-bar"></div>
                            <div class="proj-label">A√±o 1</div>
                            <div class="proj-val">‚Ç¨153.2k</div>
                        </div>
                        <div class="proj-year" style="--h:28%">
                            <div class="proj-bar bull-bar"></div>
                            <div class="proj-label">A√±o 2</div>
                            <div class="proj-val">‚Ç¨234.7k</div>
                        </div>
                        <div class="proj-year" style="--h:43%">
                            <div class="proj-bar bull-bar"></div>
                            <div class="proj-label">A√±o 3</div>
                            <div class="proj-val">‚Ç¨359.5k</div>
                        </div>
                        <div class="proj-year" style="--h:65%">
                            <div class="proj-bar bull-bar"></div>
                            <div class="proj-label">A√±o 4</div>
                            <div class="proj-val">‚Ç¨550.7k</div>
                        </div>
                        <div class="proj-year" style="--h:100%">
                            <div class="proj-bar bull-bar highlight-bar"></div>
                            <div class="proj-label">A√±o 5</div>
                            <div class="proj-val final-val">‚Ç¨843.6k</div>
                        </div>
                    </div>
                    <div class="projection-summary">
                        <div class="proj-stat">
                            <span class="proj-stat-label">Capital Inicial</span>
                            <span class="proj-stat-value">‚Ç¨100.000</span>
                        </div>
                        <div class="proj-stat">
                            <span class="proj-stat-label">Capital Final</span>
                            <span class="proj-stat-value positive">‚Ç¨843.605</span>
                        </div>
                        <div class="proj-stat">
                            <span class="proj-stat-label">Ganancia Total</span>
                            <span class="proj-stat-value positive">+‚Ç¨743.605</span>
                        </div>
                        <div class="proj-stat">
                            <span class="proj-stat-label">Multiplicador</span>
                            <span class="proj-stat-value positive">√ó8.44</span>
                        </div>
                        <div class="proj-stat">
                            <span class="proj-stat-label">Ganancia Media/Op</span>
                            <span class="proj-stat-value positive">4.01%</span>
                        </div>
                        <div class="proj-stat">
                            <span class="proj-stat-label">Ops en 5 a√±os</span>
                            <span class="proj-stat-value neutral">~54 ops</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìã Operaciones Alcistas</h2>
                    <button class="export-btn" onclick="exportToCSV('bull')">Exportar CSV</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Valor</th>
                                <th>Ticker</th>
                                <th>F. Entrada</th>
                                <th>F. Salida</th>
                                <th>P. Entrada</th>
                                <th>P. Salida</th>
                                <th>Capital</th>
                                <th>Plusval√≠a</th>
                                <th>Rent.</th>
                                <th>D√≠as</th>
                                <th>Motivo</th>
                            </tr>
                        </thead>
                        <tbody id="bullTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">üìä An√°lisis Visual</h2>
                <div class="chart-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Distribuci√≥n por Ticker</h3>
                        <canvas id="bullTickerChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Plusval√≠a por Operaci√≥n</h3>
                        <canvas id="bullTimelineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- BEAR VIEW -->
        <div class="strategy-view" id="bear-view">
            <div class="dashboard" id="bearDashboard"></div>
            
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">üìã Operaciones Bajistas</h2>
                    <button class="export-btn" onclick="exportToCSV('bear')">Exportar CSV</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Valor</th>
                                <th>Ticker</th>
                                <th>Fecha</th>
                                <th>Precio</th>
                                <th>Capital</th>
                                <th>Peso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="bearTable"></tbody>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">üìä An√°lisis Visual</h2>
                <div class="chart-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Distribuci√≥n por Ticker</h3>
                        <canvas id="bearTickerChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Evoluci√≥n Temporal</h3>
                        <canvas id="bearTimelineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- GENERAL VIEW -->
        <div class="strategy-view" id="general-view">
            <div class="dashboard" id="generalDashboard"></div>

            <div class="comparison-grid">
                <div class="comparison-card bull">
                    <h3 class="comparison-title">üêÇ RV ALCISTA</h3>
                    <div class="comparison-metrics" id="bullComparison"></div>
                </div>
                <div class="comparison-card bear">
                    <h3 class="comparison-title">üêª RV BAJISTA</h3>
                    <div class="comparison-metrics" id="bearComparison"></div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">üìä Comparativa Visual</h2>
                <div class="chart-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">Rentabilidad Comparada</h3>
                        <canvas id="generalComparisonChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Distribuci√≥n de Capital</h3>
                        <canvas id="generalCapitalChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">N√∫mero de Operaciones</h3>
                        <canvas id="generalOpsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Plusval√≠as Generadas</h3>
                        <canvas id="generalPlusChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data from Excel
        const portfolioData = {
            alcista: {
                importeAsignado: 10000,
                plusvalias: 1711.55,
                rentabilidad: 0.1712,
                benchmark: 0.1253,
                valoresAsignados: 3,
                inversionActiva: 0,
                operaciones: [
                    { valor: 'CNX RESOURCES',    ticker: 'CNX',  fechaEntrada: '2024-05-28', fechaSalida: '2024-07-31', precioEntrada: 25.25,   precioSalida: 26.50,   capital: 3000, peso: 0.30, plusvalia:  146.17, rentabilidad:  0.0486, dias: 64,  motivo: 'Voluntaria' },
                    { valor: 'TARGA RESOURCES',   ticker: 'TRGP', fechaEntrada: '2024-06-12', fechaSalida: '2024-07-09', precioEntrada: 121.34,  precioSalida: 132.365, capital: 2500, peso: 0.25, plusvalia:  240.47, rentabilidad:  0.0900, dias: 27,  motivo: 'Voluntaria' },
                    { valor: 'SPROUTS',           ticker: 'SFM',  fechaEntrada: '2024-06-25', fechaSalida: '2024-07-30', precioEntrada: 82.65,   precioSalida: 99.825,  capital: 3000, peso: 0.30, plusvalia:  615.50, rentabilidad:  0.2068, dias: 35,  motivo: 'Voluntaria' },
                    { valor: 'COLGATE',           ticker: 'CL',   fechaEntrada: '2024-07-29', fechaSalida: '2024-08-05', precioEntrada: 101.34,  precioSalida: 102.83,  capital: 2500, peso: 0.25, plusvalia:   34.96, rentabilidad:  0.0138, dias: 7,   motivo: 'Voluntaria' },
                    { valor: 'COLGATE',           ticker: 'CL',   fechaEntrada: '2024-08-06', fechaSalida: '2024-10-15', precioEntrada: 103.01,  precioSalida: 100.91,  capital: 4000, peso: 0.40, plusvalia:  -84.87, rentabilidad: -0.0211, dias: 70,  motivo: '-' },
                    { valor: 'TARGA RESOURCES',   ticker: 'TRGP', fechaEntrada: '2024-08-15', fechaSalida: '2024-09-20', precioEntrada: 141.015, precioSalida: 149.60,  capital: 4000, peso: 0.40, plusvalia:  237.29, rentabilidad:  0.0601, dias: 36,  motivo: 'Voluntaria' },
                    { valor: 'SPROUTS',           ticker: 'SFM',  fechaEntrada: '2024-09-23', fechaSalida: '2024-10-09', precioEntrada: 106.879, precioSalida: 113.985, capital: 4000, peso: 0.40, plusvalia:  266.86, rentabilidad:  0.0657, dias: 16,  motivo: '-' },
                    { valor: 'FISERV',            ticker: 'FI',   fechaEntrada: '2024-11-06', fechaSalida: '2024-11-27', precioEntrada: 211.252, precioSalida: 220.91,  capital: 3400, peso: 0.34, plusvalia:  151.76, rentabilidad:  0.0449, dias: 21,  motivo: 'Voluntaria' },
                    { valor: 'CNX RESOURCES',     ticker: 'CNX',  fechaEntrada: '2024-11-11', fechaSalida: '2024-11-25', precioEntrada: 39.95,   precioSalida: 40.70,   capital: 3500, peso: 0.35, plusvalia:   62.45, rentabilidad:  0.0178, dias: 14,  motivo: 'Voluntaria' },
                    { valor: 'TARGA RESOURCES',   ticker: 'TRGP', fechaEntrada: '2024-12-06', fechaSalida: '2025-01-10', precioEntrada: 197.98,  precioSalida: 192.86,  capital: 5000, peso: 0.50, plusvalia: -132.89, rentabilidad: -0.0268, dias: 35,  motivo: 'Voluntaria' },
                    { valor: 'BOSTON SCIENTIFIC', ticker: 'BSX',  fechaEntrada: '2025-02-03', fechaSalida: '2025-03-04', precioEntrada: 103.195, precioSalida: 102.98,  capital: 4000, peso: 0.40, plusvalia:  -12.41, rentabilidad: -0.0031, dias: 29,  motivo: 'Voluntaria' },
                    { valor: 'SPROUTS',           ticker: 'SFM',  fechaEntrada: '2025-02-12', fechaSalida: '2025-06-23', precioEntrada: 170.72,  precioSalida: 171.36,  capital: 4000, peso: 0.40, plusvalia:   11.75, rentabilidad:  0.0030, dias: 131, motivo: 'Voluntaria' },
                    { valor: 'OLD REPUBLIC',      ticker: 'ORI',  fechaEntrada: '2025-04-01', fechaSalida: '2025-04-04', precioEntrada: 39.43,   precioSalida: 38.03,   capital: 3000, peso: 0.30, plusvalia: -110.26, rentabilidad: -0.0363, dias: 3,   motivo: 'Voluntaria' },
                    { valor: 'TARGA RESOURCES',   ticker: 'TRGP', fechaEntrada: '2025-04-09', fechaSalida: '2025-04-22', precioEntrada: 172.96,  precioSalida: 171.18,  capital: 2600, peso: 0.26, plusvalia:  -28.98, rentabilidad: -0.0112, dias: 13,  motivo: 'Stop' },
                    { valor: 'AMICUS',            ticker: 'CRK',  fechaEntrada: '2025-06-16', fechaSalida: '2025-06-20', precioEntrada: 26.26,   precioSalida: 30.21,   capital: 4000, peso: 0.40, plusvalia:  313.74, rentabilidad:  0.1493, dias: 4,   motivo: 'Voluntaria' }
                ]
            },
            bajista: {
                importeAsignado: 10000,
                plusvalias: 1351.38,
                rentabilidad: 0.1351,
                benchmark: 0,
                valoresAsignados: 3,
                inversionActiva: 0,
                operaciones: [
                    { valor: 'SUNNOVA ENERGY', ticker: 'NOVA', fecha: '2024-05-17', precio: 5.55, capital: 5000, peso: 0.50 },
                    { valor: 'STEM INC', ticker: 'STEM', fecha: '2024-05-21', precio: 0.48, capital: 4800, peso: 0.48 },
                    { valor: 'STEM INC', ticker: 'STEM', fecha: '2024-05-22', precio: 0.47, capital: 2000, peso: 0.20 },
                    { valor: 'MGM CHINA', ticker: 'MCG', fecha: '2024-05-23', precio: 9.5, capital: 1000, peso: 0.10 },
                    { valor: 'MEREDITH', ticker: 'MD', fecha: '2024-06-25', precio: 26.13, capital: 2000, peso: 0.20 },
                    { valor: 'CANADIAN SOLAR', ticker: 'CSIQ', fecha: '2024-07-10', precio: 16.64, capital: 3000, peso: 0.30 },
                    { valor: 'PLUG POWER', ticker: 'PLUG', fecha: '2024-08-08', precio: 2.37, capital: 4000, peso: 0.40 },
                    { valor: 'CANADIAN SOLAR', ticker: 'CSIQ', fecha: '2024-08-06', precio: 15.83, capital: 2500, peso: 0.25 },
                    { valor: 'CANADIAN SOLAR', ticker: 'CSIQ', fecha: '2024-08-07', precio: 16.64, capital: 2500, peso: 0.25 },
                    { valor: 'WOLFSPEED', ticker: 'WLOF', fecha: '2024-08-12', precio: 9.08, capital: 2000, peso: 0.20 },
                    { valor: 'PLUG POWER', ticker: 'PLUG', fecha: '2024-08-21', precio: 2.06, capital: 2700, peso: 0.27 },
                    { valor: 'WOLFSPEED', ticker: 'WOLF', fecha: '2024-08-26', precio: 8.63, capital: 2700, peso: 0.27 },
                    { valor: 'TALOS ENERGY', ticker: 'TALO', fecha: '2024-09-04', precio: 9.67, capital: 2700, peso: 0.27 },
                    { valor: 'NATIONAL VISION', ticker: 'EYE', fecha: '2024-09-20', precio: 11.99, capital: 3600, peso: 0.36 },
                    { valor: 'WOLFSPEED', ticker: 'WOLF', fecha: '2024-09-23', precio: 9.83, capital: 2700, peso: 0.27 },
                    { valor: 'TALOS ENERGY', ticker: 'TALO', fecha: '2024-10-29', precio: 10.67, capital: 2700, peso: 0.27 },
                    { valor: 'ANGLO GOLD', ticker: 'AGL', fecha: '2024-11-07', precio: 31.6, capital: 3000, peso: 0.30 },
                    { valor: 'WOLFSPEED', ticker: 'WOLF', fecha: '2024-11-11', precio: 10.72, capital: 3000, peso: 0.30 },
                    { valor: 'PLUG POWER', ticker: 'PLUG', fecha: '2024-11-12', precio: 2.34, capital: 2500, peso: 0.25 },
                    { valor: 'ANGLO GOLD', ticker: 'AGL', fecha: '2024-11-12', precio: 32.99, capital: 2500, peso: 0.25 }
                ]
            }
        };

        // Calculate metrics
        function calculateMetrics(data) {
            const totalCapital = data.operaciones.reduce((sum, op) => sum + op.capital, 0);
            const avgCapital = totalCapital / data.operaciones.length;
            const rentabilidadPorOp = data.plusvalias / data.operaciones.length;
            
            const firstDate = new Date(data.operaciones[0].fecha);
            const lastDate = new Date(data.operaciones[data.operaciones.length - 1].fecha);
            const years = (lastDate - firstDate) / (365.25 * 24 * 60 * 60 * 1000);
            const cagr = Math.pow(1 + data.rentabilidad, 1/years) - 1;
            
            return {
                totalCapital,
                avgCapital,
                rentabilidadPorOp,
                cagr,
                numOperaciones: data.operaciones.length
            };
        }

        const bullMetrics = calculateMetrics(portfolioData.alcista);
        const bearMetrics = calculateMetrics(portfolioData.bajista);

        // Render Dashboards
        function renderBullDashboard() {
            const dashboard = document.getElementById('bullDashboard');
            const cards = [
                { icon: 'üí∞', label: 'Importe Asignado', value: `‚Ç¨${portfolioData.alcista.importeAsignado.toLocaleString('es-ES')}`, change: 'Capital disponible', class: 'bull' },
                { icon: 'üìà', label: 'Plusval√≠as', value: `‚Ç¨${portfolioData.alcista.plusvalias.toLocaleString('es-ES', {minimumFractionDigits: 2})}`, change: `+${(portfolioData.alcista.rentabilidad * 100).toFixed(2)}%`, class: 'bull' },
                { icon: 'üéØ', label: 'Rentabilidad', value: `${(portfolioData.alcista.rentabilidad * 100).toFixed(2)}%`, change: `CAGR: ${(bullMetrics.cagr * 100).toFixed(2)}%`, class: 'bull' },
                { icon: 'üìä', label: 'vs Benchmark', value: `${(portfolioData.alcista.benchmark * 100).toFixed(2)}%`, change: `Dif: ${((portfolioData.alcista.rentabilidad - portfolioData.alcista.benchmark) * 100).toFixed(2)}%`, class: 'neutral' },
                { icon: 'üíº', label: 'Capital Total', value: `‚Ç¨${bullMetrics.totalCapital.toLocaleString('es-ES')}`, change: `${bullMetrics.numOperaciones} operaciones`, class: 'bull' },
                { icon: '‚ö°', label: 'Promedio/Op', value: `‚Ç¨${bullMetrics.rentabilidadPorOp.toFixed(2)}`, change: `Cap medio: ‚Ç¨${bullMetrics.avgCapital.toFixed(0)}`, class: 'bull' }
            ];

            dashboard.innerHTML = cards.map(card => `
                <div class="metric-card ${card.class}">
                    <div class="metric-icon">${card.icon}</div>
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    <div class="metric-change">${card.change}</div>
                </div>
            `).join('');
        }

        function renderBearDashboard() {
            const dashboard = document.getElementById('bearDashboard');
            const cards = [
                { icon: 'üí∞', label: 'Importe Asignado', value: `‚Ç¨${portfolioData.bajista.importeAsignado.toLocaleString('es-ES')}`, change: 'Capital disponible', class: 'bear' },
                { icon: 'üìà', label: 'Plusval√≠as', value: `‚Ç¨${portfolioData.bajista.plusvalias.toLocaleString('es-ES', {minimumFractionDigits: 2})}`, change: `+${(portfolioData.bajista.rentabilidad * 100).toFixed(2)}%`, class: 'bear' },
                { icon: 'üéØ', label: 'Rentabilidad', value: `${(portfolioData.bajista.rentabilidad * 100).toFixed(2)}%`, change: `CAGR: ${(bearMetrics.cagr * 100).toFixed(2)}%`, class: 'bear' },
                { icon: 'üè¢', label: 'Valores √önicos', value: new Set(portfolioData.bajista.operaciones.map(op => op.ticker)).size, change: `${portfolioData.bajista.valoresAsignados} asignados`, class: 'neutral' },
                { icon: 'üíº', label: 'Capital Total', value: `‚Ç¨${bearMetrics.totalCapital.toLocaleString('es-ES')}`, change: `${bearMetrics.numOperaciones} operaciones`, class: 'bear' },
                { icon: '‚ö°', label: 'Promedio/Op', value: `‚Ç¨${bearMetrics.rentabilidadPorOp.toFixed(2)}`, change: `Cap medio: ‚Ç¨${bearMetrics.avgCapital.toFixed(0)}`, class: 'bear' }
            ];

            dashboard.innerHTML = cards.map(card => `
                <div class="metric-card ${card.class}">
                    <div class="metric-icon">${card.icon}</div>
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    <div class="metric-change">${card.change}</div>
                </div>
            `).join('');
        }

        function renderGeneralDashboard() {
            const totalPlusvalias = portfolioData.alcista.plusvalias + portfolioData.bajista.plusvalias;
            const totalCapital = bullMetrics.totalCapital + bearMetrics.totalCapital;
            const totalOps = bullMetrics.numOperaciones + bearMetrics.numOperaciones;
            const avgRent = (portfolioData.alcista.rentabilidad + portfolioData.bajista.rentabilidad) / 2;

            const dashboard = document.getElementById('generalDashboard');
            const cards = [
                { icon: 'üí∞', label: 'Capital Total Invertido', value: `‚Ç¨${totalCapital.toLocaleString('es-ES')}`, change: `${totalOps} operaciones totales`, class: 'neutral' },
                { icon: 'üìà', label: 'Plusval√≠as Totales', value: `‚Ç¨${totalPlusvalias.toLocaleString('es-ES', {minimumFractionDigits: 2})}`, change: 'Ambas estrategias', class: 'neutral' },
                { icon: 'üéØ', label: 'Rentabilidad Media', value: `${(avgRent * 100).toFixed(2)}%`, change: `Alcista: ${(portfolioData.alcista.rentabilidad * 100).toFixed(2)}% | Bajista: ${(portfolioData.bajista.rentabilidad * 100).toFixed(2)}%`, class: 'neutral' },
                { icon: 'üêÇ', label: 'Mejor Estrategia', value: portfolioData.alcista.rentabilidad > portfolioData.bajista.rentabilidad ? 'ALCISTA' : 'BAJISTA', change: `Diferencia: ${(Math.abs(portfolioData.alcista.rentabilidad - portfolioData.bajista.rentabilidad) * 100).toFixed(2)}%`, class: 'neutral' },
                { icon: '‚ö°', label: 'Promedio Global/Op', value: `‚Ç¨${(totalPlusvalias / totalOps).toFixed(2)}`, change: `Bull: ‚Ç¨${bullMetrics.rentabilidadPorOp.toFixed(2)} | Bear: ‚Ç¨${bearMetrics.rentabilidadPorOp.toFixed(2)}`, class: 'neutral' },
                { icon: 'üìä', label: 'Diversificaci√≥n', value: `${new Set([...portfolioData.alcista.operaciones.map(op => op.ticker), ...portfolioData.bajista.operaciones.map(op => op.ticker)]).size} tickers`, change: `Bull: ${new Set(portfolioData.alcista.operaciones.map(op => op.ticker)).size} | Bear: ${new Set(portfolioData.bajista.operaciones.map(op => op.ticker)).size}`, class: 'neutral' }
            ];

            dashboard.innerHTML = cards.map(card => `
                <div class="metric-card ${card.class}">
                    <div class="metric-icon">${card.icon}</div>
                    <div class="metric-label">${card.label}</div>
                    <div class="metric-value">${card.value}</div>
                    <div class="metric-change">${card.change}</div>
                </div>
            `).join('');
        }

        // Calculate Ratios
        function calcRatios(data) {
            const ops = data.operaciones;
            const winners = ops.filter(op => op.plusvalia > 0);
            const losers  = ops.filter(op => op.plusvalia <= 0);
            const rents   = ops.map(op => op.rentabilidad);
            const diasArr = ops.map(op => op.dias).filter(d => d > 0);

            const totalPlusvalias  = ops.reduce((s, op) => s + op.plusvalia, 0);
            const rentCartera      = totalPlusvalias / data.importeAsignado;
            const diasTotales      = 391;
            const anios            = diasTotales / 365.25;
            const cagr             = Math.pow(1 + rentCartera, 1 / anios) - 1;
            const winRate          = winners.length / ops.length;

            // M√°xima ganancia y p√©rdida por % de rentabilidad
            const maxGanancia = ops.reduce((a, b) => a.rentabilidad > b.rentabilidad ? a : b);
            const maxPerdida  = ops.reduce((a, b) => a.rentabilidad < b.rentabilidad ? a : b);

            // Promedios en % (rentabilidad media de ganadoras y perdedoras)
            const avgWinPct  = winners.length ? winners.reduce((s, op) => s + op.rentabilidad, 0) / winners.length : 0;
            const avgLossPct = losers.length  ? Math.abs(losers.reduce((s, op) => s + op.rentabilidad, 0) / losers.length) : 0;

            // Esperanza matem√°tica en % sobre capital
            const esperanza = winRate * avgWinPct - (1 - winRate) * avgLossPct;

            // Sharpe sobre rentabilidades por operaci√≥n
            const meanRent = rents.reduce((s, r) => s + r, 0) / rents.length;
            const stdRent  = Math.sqrt(rents.reduce((s, r) => s + Math.pow(r - meanRent, 2), 0) / rents.length);
            const sharpe   = stdRent > 0 ? (meanRent - 0.02/12) / stdRent : 0;

            const gananciaPromedio = totalPlusvalias / ops.length;
            const diasPromedio     = diasArr.reduce((s, d) => s + d, 0) / diasArr.length;

            return { rentCartera, cagr, winRate, maxGanancia, maxPerdida, avgWinPct, avgLossPct, esperanza, sharpe, gananciaPromedio, diasPromedio, winners, losers };
        }

        function renderBullRatios() {
            const r = calcRatios(portfolioData.alcista);
            const container = document.getElementById('bullRatios');

            // Ganancia media % real (media de rentabilidades individuales)
            const rents = portfolioData.alcista.operaciones.map(op => op.rentabilidad);
            const gananciaMediaPct = rents.reduce((s, v) => s + v, 0) / rents.length;

            const cards = [
                {
                    icon: 'üìà', label: 'Rentabilidad Cartera', value: `${(r.rentCartera*100).toFixed(2)}%`,
                    badge: r.rentCartera > 0 ? 'up' : 'down', badgeLabel: r.rentCartera > 0 ? '‚ñ≤ Positiva' : '‚ñº Negativa',
                    desc: 'Total plusval√≠as sobre capital asignado (‚Ç¨10.000)',
                    sub: `‚Ç¨${portfolioData.alcista.plusvalias.toFixed(2)} generados en total`, class: 'bull'
                },
                {
                    icon: 'üìÖ', label: 'Rentabilidad Anualizada', value: `${(r.cagr*100).toFixed(2)}%`,
                    badge: 'up', badgeLabel: 'CAGR',
                    desc: 'Tasa de crecimiento compuesta anual del portfolio',
                    sub: `Periodo analizado: 391 d√≠as`, class: 'bull'
                },
                {
                    icon: 'üéØ', label: '% Win Rate', value: `${(r.winRate*100).toFixed(1)}%`,
                    badge: r.winRate >= 0.5 ? 'up' : 'down', badgeLabel: `${r.winners.length}/${portfolioData.alcista.operaciones.length}`,
                    desc: 'Porcentaje de operaciones con resultado positivo',
                    sub: `${r.winners.length} ganadoras ¬∑ ${r.losers.length} perdedoras`, class: 'bull'
                },
                {
                    icon: 'üèÜ', label: 'M√°xima Ganancia', value: `+${(r.maxGanancia.rentabilidad*100).toFixed(2)}%`,
                    badge: 'up', badgeLabel: `+‚Ç¨${r.maxGanancia.plusvalia.toFixed(2)}`,
                    desc: 'Mejor rentabilidad en una √∫nica operaci√≥n',
                    sub: `${r.maxGanancia.ticker} ¬∑ ${r.maxGanancia.dias} d√≠as`, class: 'bull'
                },
                {
                    icon: 'üîª', label: 'M√°xima P√©rdida', value: `${(r.maxPerdida.rentabilidad*100).toFixed(2)}%`,
                    badge: 'down', badgeLabel: `‚Ç¨${r.maxPerdida.plusvalia.toFixed(2)}`,
                    desc: 'Peor rentabilidad en una √∫nica operaci√≥n',
                    sub: `${r.maxPerdida.ticker} ¬∑ ${r.maxPerdida.dias} d√≠as ¬∑ ${r.maxPerdida.motivo}`, class: 'bear'
                },
                {
                    icon: 'üßÆ', label: 'Esperanza Matem√°tica', value: `${(r.esperanza * 100).toFixed(2)}%`,
                    badge: r.esperanza > 0 ? 'up' : 'down', badgeLabel: `‚Ç¨${(r.esperanza * 10000 / 100).toFixed(2)}/op`,
                    desc: 'Rentabilidad esperada por operaci√≥n ponderada por probabilidad (% sobre capital)',
                    sub: `Avg win: +${(r.avgWinPct*100).toFixed(2)}% ¬∑ Avg loss: ${(r.avgLossPct*100).toFixed(2)}%`, class: r.esperanza > 0 ? 'bull' : 'bear'
                },
                {
                    icon: '‚öñÔ∏è', label: 'Ratio de Sharpe', value: r.sharpe.toFixed(2),
                    badge: r.sharpe >= 1 ? 'up' : r.sharpe >= 0 ? 'flat' : 'down',
                    badgeLabel: r.sharpe >= 1 ? 'Bueno' : r.sharpe >= 0 ? 'Regular' : 'Bajo',
                    desc: 'Rentabilidad ajustada al riesgo (rf=2% anual)',
                    sub: `>1 excelente ¬∑ 0.5-1 aceptable ¬∑ <0.5 bajo`, class: 'neutral'
                },
                {
                    icon: 'üìä', label: 'Ganancia Media por Operaci√≥n', value: `${(gananciaMediaPct*100).toFixed(2)}%`,
                    badge: 'flat', badgeLabel: `${r.diasPromedio.toFixed(0)} d√≠as/op`,
                    desc: 'Rentabilidad media y duraci√≥n promedio de cada operaci√≥n',
                    sub: `~${(365.25/r.diasPromedio).toFixed(1)} ops/a√±o ¬∑ Cap. medio: ‚Ç¨${(portfolioData.alcista.operaciones.reduce((s,o)=>s+o.capital,0)/portfolioData.alcista.operaciones.length).toFixed(0)}`, class: 'neutral'
                }
            ];

            container.innerHTML = cards.map(card => `
                <div class="ratio-card ${card.class}">
                    <div class="ratio-top">
                        <span class="ratio-icon">${card.icon}</span>
                        <span class="ratio-badge ${card.badge}">${card.badgeLabel}</span>
                    </div>
                    <div class="ratio-label">${card.label}</div>
                    <div class="ratio-value ${card.class === 'bull' ? 'positive' : card.class === 'bear' ? 'negative' : 'neutral'}">${card.value}</div>
                    <div class="ratio-desc">${card.desc}</div>
                    <div class="ratio-sub">${card.sub}</div>
                </div>
            `).join('');
        }

        // Render Tables
        function renderBullTable() {
            const tbody = document.getElementById('bullTable');
            tbody.innerHTML = portfolioData.alcista.operaciones.map(op => {
                const esGanadora = op.plusvalia > 0;
                return `
                    <tr>
                        <td><strong>${op.valor}</strong></td>
                        <td><span class="ticker bull">${op.ticker}</span></td>
                        <td>${new Date(op.fechaEntrada).toLocaleDateString('es-ES')}</td>
                        <td>${new Date(op.fechaSalida).toLocaleDateString('es-ES')}</td>
                        <td>‚Ç¨${op.precioEntrada.toFixed(2)}</td>
                        <td>‚Ç¨${op.precioSalida.toFixed(2)}</td>
                        <td>‚Ç¨${op.capital.toLocaleString('es-ES')}</td>
                        <td class="${esGanadora ? 'positive' : 'negative'}"><strong>${esGanadora ? '+' : ''}‚Ç¨${op.plusvalia.toFixed(2)}</strong></td>
                        <td class="${esGanadora ? 'positive' : 'negative'}">${esGanadora ? '+' : ''}${(op.rentabilidad*100).toFixed(2)}%</td>
                        <td>${op.dias}d</td>
                        <td><span style="font-size:0.85em;color:var(--text-secondary)">${op.motivo}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function renderBearTable() {
            const tbody = document.getElementById('bearTable');
            tbody.innerHTML = portfolioData.bajista.operaciones.map(op => `
                <tr>
                    <td><strong>${op.valor}</strong></td>
                    <td><span class="ticker bear">${op.ticker}</span></td>
                    <td>${new Date(op.fecha).toLocaleDateString('es-ES')}</td>
                    <td>‚Ç¨${op.precio.toFixed(2)}</td>
                    <td>‚Ç¨${op.capital.toLocaleString('es-ES')}</td>
                    <td>${(op.peso * 100).toFixed(0)}%</td>
                    <td>${(op.capital / op.precio).toFixed(2)}</td>
                </tr>
            `).join('');
        }

        // Render Comparisons
        function renderComparisons() {
            const bullComp = document.getElementById('bullComparison');
            bullComp.innerHTML = `
                <div class="comparison-item">
                    <label>Rentabilidad</label>
                    <span class="value positive">${(portfolioData.alcista.rentabilidad * 100).toFixed(2)}%</span>
                </div>
                <div class="comparison-item">
                    <label>Plusval√≠as</label>
                    <span class="value">‚Ç¨${portfolioData.alcista.plusvalias.toFixed(2)}</span>
                </div>
                <div class="comparison-item">
                    <label>Operaciones</label>
                    <span class="value">${bullMetrics.numOperaciones}</span>
                </div>
                <div class="comparison-item">
                    <label>Capital Total</label>
                    <span class="value">‚Ç¨${bullMetrics.totalCapital.toLocaleString('es-ES')}</span>
                </div>
            `;

            const bearComp = document.getElementById('bearComparison');
            bearComp.innerHTML = `
                <div class="comparison-item">
                    <label>Rentabilidad</label>
                    <span class="value positive">${(portfolioData.bajista.rentabilidad * 100).toFixed(2)}%</span>
                </div>
                <div class="comparison-item">
                    <label>Plusval√≠as</label>
                    <span class="value">‚Ç¨${portfolioData.bajista.plusvalias.toFixed(2)}</span>
                </div>
                <div class="comparison-item">
                    <label>Operaciones</label>
                    <span class="value">${bearMetrics.numOperaciones}</span>
                </div>
                <div class="comparison-item">
                    <label>Capital Total</label>
                    <span class="value">‚Ç¨${bearMetrics.totalCapital.toLocaleString('es-ES')}</span>
                </div>
            `;
        }

        // Chart Configuration
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#1e293b';

        // Create Charts
        function createBullTickerChart() {
            const ctx = document.getElementById('bullTickerChart');
            const tickerCapital = portfolioData.alcista.operaciones.reduce((acc, op) => {
                acc[op.ticker] = (acc[op.ticker] || 0) + op.capital;
                return acc;
            }, {});
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(tickerCapital),
                    datasets: [{
                        data: Object.values(tickerCapital),
                        backgroundColor: ['#00d4aa', '#00b894', '#00a085', '#008876', '#007067'],
                        borderWidth: 2,
                        borderColor: '#141b2d'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function createBullTimelineChart() {
            const ctx = document.getElementById('bullTimelineChart');
            const ops = portfolioData.alcista.operaciones;
            const labels = ops.map(op => op.ticker);
            const data   = ops.map(op => op.plusvalia);
            const colors = data.map(v => v >= 0 ? 'rgba(0,212,170,0.75)' : 'rgba(255,107,157,0.75)');
            const borders= data.map(v => v >= 0 ? '#00d4aa' : '#ff6b9d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Plusval√≠a (‚Ç¨)',
                        data,
                        backgroundColor: colors,
                        borderColor: borders,
                        borderWidth: 1.5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => ` ‚Ç¨${ctx.parsed.y.toFixed(2)}` } }
                    },
                    scales: {
                        y: { ticks: { callback: v => '‚Ç¨' + v }, grid: { color: 'rgba(255,255,255,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function createBearTickerChart() {
            const ctx = document.getElementById('bearTickerChart');
            const tickerCapital = portfolioData.bajista.operaciones.reduce((acc, op) => {
                acc[op.ticker] = (acc[op.ticker] || 0) + op.capital;
                return acc;
            }, {});
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(tickerCapital),
                    datasets: [{
                        data: Object.values(tickerCapital),
                        backgroundColor: ['#ff6b9d', '#ff4757', '#ee5a6f', '#dc4c87', '#ca3f9f'],
                        borderWidth: 2,
                        borderColor: '#141b2d'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function createBearTimelineChart() {
            const ctx = document.getElementById('bearTimelineChart');
            const dates = portfolioData.bajista.operaciones.map(op => new Date(op.fecha).toLocaleDateString('es-ES', { month: 'short', day: 'numeric' }));
            const capitals = portfolioData.bajista.operaciones.map(op => op.capital);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Capital',
                        data: capitals,
                        borderColor: '#ff6b9d',
                        backgroundColor: 'rgba(255, 107, 157, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => '‚Ç¨' + value.toLocaleString('es-ES') }
                        }
                    }
                }
            });
        }

        function createGeneralCharts() {
            // Comparison Chart
            const ctx1 = document.getElementById('generalComparisonChart');
            new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Alcista', 'Bajista'],
                    datasets: [{
                        label: 'Rentabilidad (%)',
                        data: [portfolioData.alcista.rentabilidad * 100, portfolioData.bajista.rentabilidad * 100],
                        backgroundColor: ['rgba(0, 212, 170, 0.8)', 'rgba(255, 107, 157, 0.8)'],
                        borderColor: ['#00d4aa', '#ff6b9d'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => value + '%' }
                        }
                    }
                }
            });

            // Capital Chart
            const ctx2 = document.getElementById('generalCapitalChart');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Alcista', 'Bajista'],
                    datasets: [{
                        data: [bullMetrics.totalCapital, bearMetrics.totalCapital],
                        backgroundColor: ['#00d4aa', '#ff6b9d'],
                        borderWidth: 2,
                        borderColor: '#141b2d'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });

            // Operations Chart
            const ctx3 = document.getElementById('generalOpsChart');
            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: ['Alcista', 'Bajista'],
                    datasets: [{
                        label: 'N√∫mero de Operaciones',
                        data: [bullMetrics.numOperaciones, bearMetrics.numOperaciones],
                        backgroundColor: ['rgba(0, 212, 170, 0.8)', 'rgba(255, 107, 157, 0.8)'],
                        borderColor: ['#00d4aa', '#ff6b9d'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } }
                }
            });

            // Plusvalias Chart
            const ctx4 = document.getElementById('generalPlusChart');
            new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: ['Alcista', 'Bajista'],
                    datasets: [{
                        label: 'Plusval√≠as (‚Ç¨)',
                        data: [portfolioData.alcista.plusvalias, portfolioData.bajista.plusvalias],
                        backgroundColor: ['rgba(0, 212, 170, 0.8)', 'rgba(255, 107, 157, 0.8)'],
                        borderColor: ['#00d4aa', '#ff6b9d'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: value => '‚Ç¨' + value.toLocaleString('es-ES') }
                        }
                    }
                }
            });
        }

        // Strategy Switcher
        function switchStrategy(strategy) {
            // Update buttons
            document.querySelectorAll('.strategy-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.strategy-btn.${strategy === 'bull' ? 'bull' : strategy === 'bear' ? 'bear' : 'general'}`).classList.add('active');
            
            // Update views
            document.querySelectorAll('.strategy-view').forEach(view => view.classList.remove('active'));
            document.getElementById(`${strategy}-view`).classList.add('active');
        }

        // Export to CSV
        function exportToCSV(type) {
            const data = type === 'bull' ? portfolioData.alcista.operaciones : portfolioData.bajista.operaciones;
            const headers = ['Valor', 'Ticker', 'Fecha', 'Precio', 'Capital', 'Peso', 'Acciones'];
            const rows = data.map(op => [
                op.valor,
                op.ticker,
                op.fecha,
                op.precio,
                op.capital,
                op.peso,
                (op.capital / op.precio).toFixed(2)
            ]);
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rv_${type}_operations.csv`;
            a.click();
        }

        // Initialize
        renderBullRatios();
        renderBullDashboard();
        renderBearDashboard();
        renderGeneralDashboard();
        renderBullTable();
        renderBearTable();
        renderComparisons();
        createBullTickerChart();
        createBullTimelineChart();
        createBearTickerChart();
        createBearTimelineChart();
        createGeneralCharts();
    </script>
</body>
</html>
